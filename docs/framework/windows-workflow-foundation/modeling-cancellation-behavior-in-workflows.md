---
title: "워크플로의 취소 동작 모델링"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: d48f6cf3-cdde-4dd3-8265-a665acf32a03
caps.latest.revision: "11"
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.workload: dotnet
ms.openlocfilehash: 94a3cb69e2e897e992a05a19325630ca9bb1ae3a
ms.sourcegitcommit: 16186c34a957fdd52e5db7294f291f7530ac9d24
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 12/22/2017
---
# <a name="modeling-cancellation-behavior-in-workflows"></a><span data-ttu-id="d2dfa-102">워크플로의 취소 동작 모델링</span><span class="sxs-lookup"><span data-stu-id="d2dfa-102">Modeling Cancellation Behavior in Workflows</span></span>
<span data-ttu-id="d2dfa-103">워크플로 내에서 활동을 취소할 수도 있고(예: <xref:System.Activities.Statements.Parallel>의 평가 결과가 <xref:System.Activities.Statements.Parallel.CompletionCondition%2A>일 때 완료되지 않은 분기를 `true` 활동을 사용하여 취소하는 경우), 호스트가  <xref:System.Activities.WorkflowApplication.Cancel%2A>을 호출하는 경우에는 워크플로 외부에서 활동을 취소할 수도 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-103">Activities can be canceled inside a workflow, for example by a <xref:System.Activities.Statements.Parallel> activity canceling incomplete branches when its <xref:System.Activities.Statements.Parallel.CompletionCondition%2A> evaluates to `true`, or from outside the workflow, if the host calls <xref:System.Activities.WorkflowApplication.Cancel%2A>.</span></span> <span data-ttu-id="d2dfa-104">취소 처리를 위해 워크플로 작성자는 <xref:System.Activities.Statements.CancellationScope> 활동 또는 <xref:System.Activities.Statements.CompensableActivity> 활동을 사용하거나 취소 논리를 제공하는 사용자 지정 활동을 만들 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-104">To provide cancellation handling, workflow authors can use the <xref:System.Activities.Statements.CancellationScope> activity, the <xref:System.Activities.Statements.CompensableActivity> activity, or create custom activities that provide cancellation logic.</span></span> <span data-ttu-id="d2dfa-105">이 항목에서는 워크플로의 취소에 대해 간략하게 설명합니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-105">This topic provides an overview of cancellation in workflows.</span></span>  
  
## <a name="cancellation-compensation-and-transactions"></a><span data-ttu-id="d2dfa-106">취소, 보정 및 트랜잭션</span><span class="sxs-lookup"><span data-stu-id="d2dfa-106">Cancellation, Compensation, and Transactions</span></span>  
 <span data-ttu-id="d2dfa-107">응용 프로그램에 트랜잭션을 사용하면 트랜잭션 프로세스의 일부에서 오류가 발생하는 경우 트랜잭션 내에서 실행된 모든 변경 내용을 중단(롤백)할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-107">Transactions give your application the ability to abort (roll back) all changes executed within the transaction if any errors occur during any part of the transaction process.</span></span> <span data-ttu-id="d2dfa-108">그러나 취소하거나 실행을 취소해야 하는 작업 중에는 장기 실행 작업이나 트랜잭션 리소스가 관련되지 않은 작업처럼 트랜잭션에 적합하지 않은 작업도 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-108">However, not all work that may need to be canceled or undone is appropriate for transactions, such as long-running work or work that does not involve transactional resources.</span></span> <span data-ttu-id="d2dfa-109">보정은 워크플로에서 오류가 발생할 경우 이전에 완료된 비트랜잭션 작업의 실행을 취소하는 모델을 제공합니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-109">Compensation provides a model for undoing previously completed non-transactional work if there is a subsequent failure in the workflow.</span></span> <span data-ttu-id="d2dfa-110">취소는 워크플로 및 활동 작성자가 완료되지 않은 비트랜잭션 작업을 처리하는 모델을 제공합니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-110">Cancellation provides a model for workflow and activity authors to handle non-transactional work that was not completed.</span></span> <span data-ttu-id="d2dfa-111">활동의 실행이 완료되지 않은 상태에서 활동을 취소한 경우 적용 가능한 취소 논리가 있으면 해당 논리가 호출됩니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-111">If an activity has not completed its execution and it is canceled, its cancellation logic will be invoked if it is available.</span></span>  
  
> [!NOTE]
>  [!INCLUDE[crabout](../../../includes/crabout-md.md)]<span data-ttu-id="d2dfa-112">트랜잭션 및 보정 참조 [트랜잭션을](../../../docs/framework/windows-workflow-foundation/workflow-transactions.md) 및 [보정](../../../docs/framework/windows-workflow-foundation/compensation.md)합니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-112"> transactions and compensation, see [Transactions](../../../docs/framework/windows-workflow-foundation/workflow-transactions.md) and [Compensation](../../../docs/framework/windows-workflow-foundation/compensation.md).</span></span>  
  
## <a name="using-cancellationscope"></a><span data-ttu-id="d2dfa-113">CancellationScope 사용</span><span class="sxs-lookup"><span data-stu-id="d2dfa-113">Using CancellationScope</span></span>  
 <span data-ttu-id="d2dfa-114"><xref:System.Activities.Statements.CancellationScope> 활동에는 자식 활동을 포함할 수 있는 <xref:System.Activities.Statements.CancellationScope.Body%2A>와 <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A>라는 두 개의 섹션이 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-114">The <xref:System.Activities.Statements.CancellationScope> activity has two sections that can contain child activities: <xref:System.Activities.Statements.CancellationScope.Body%2A> and <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A>.</span></span> <span data-ttu-id="d2dfa-115"><xref:System.Activities.Statements.CancellationScope.Body%2A>는 활동의 논리를 구성하는 자식 활동이 포함되는 위치이며, <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A>는 활동에 대한 취소 논리를 제공하는 자식 활동이 포함되는 위치입니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-115">The <xref:System.Activities.Statements.CancellationScope.Body%2A> is where the activities that make up the logic of the activity are placed, and the <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> is where the activities that provide cancellation logic for the activity are placed.</span></span> <span data-ttu-id="d2dfa-116">활동은 완료되지 않은 경우에만 취소할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-116">An activity can be canceled only if it has not completed.</span></span> <span data-ttu-id="d2dfa-117"><xref:System.Activities.Statements.CancellationScope> 활동의 경우 완료란 <xref:System.Activities.Statements.CancellationScope.Body%2A>에 포함된 활동이 완료되었음을 의미합니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-117">In the case of the <xref:System.Activities.Statements.CancellationScope> activity, completion refers to the completion of the activities in the <xref:System.Activities.Statements.CancellationScope.Body%2A>.</span></span> <span data-ttu-id="d2dfa-118">취소 요청이 예약되어 있고 <xref:System.Activities.Statements.CancellationScope.Body%2A>의 활동이 완료되지 않은 경우 <xref:System.Activities.Statements.CancellationScope>가 <xref:System.Activities.ActivityInstanceState.Canceled>로 표시되고 <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> 활동이 실행됩니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-118">If a cancellation request is scheduled and the activities in the <xref:System.Activities.Statements.CancellationScope.Body%2A> have not completed, then the <xref:System.Activities.Statements.CancellationScope> will be marked as <xref:System.Activities.ActivityInstanceState.Canceled> and the <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> activities will be executed.</span></span>  
  
### <a name="canceling-a-workflow-from-the-host"></a><span data-ttu-id="d2dfa-119">호스트에서 워크플로 취소</span><span class="sxs-lookup"><span data-stu-id="d2dfa-119">Canceling a Workflow from the Host</span></span>  
 <span data-ttu-id="d2dfa-120">워크플로를 호스트하는 <xref:System.Activities.WorkflowApplication.Cancel%2A> 인스턴스의 <xref:System.Activities.WorkflowApplication> 메서드를 호출하여 호스트에서 워크플로를 취소할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-120">A host can cancel a workflow by calling the <xref:System.Activities.WorkflowApplication.Cancel%2A> method of the <xref:System.Activities.WorkflowApplication> instance that is hosting the workflow.</span></span> <span data-ttu-id="d2dfa-121">다음 예제에서는 <xref:System.Activities.Statements.CancellationScope>가 있는 워크플로를 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-121">In the following example a workflow is created that has a <xref:System.Activities.Statements.CancellationScope>.</span></span> <span data-ttu-id="d2dfa-122">이 워크플로가 호출되면 호스트에서 <xref:System.Activities.WorkflowApplication.Cancel%2A>을 호출합니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-122">The workflow is invoked, and then the host makes a call to <xref:System.Activities.WorkflowApplication.Cancel%2A>.</span></span> <span data-ttu-id="d2dfa-123">그 결과로 워크플로의 주 실행이 중지되고 <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A>의 <xref:System.Activities.Statements.CancellationScope>가 호출된 다음 워크플로가 <xref:System.Activities.ActivityInstanceState.Canceled> 상태로 완료됩니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-123">The main execution of the workflow is stopped, the <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> of the <xref:System.Activities.Statements.CancellationScope> is invoked, and then the workflow completes with a status of <xref:System.Activities.ActivityInstanceState.Canceled>.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#35](../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#35)]  
  
 <span data-ttu-id="d2dfa-124">이 워크플로가 호출되면 다음 출력이 콘솔에 표시됩니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-124">When this workflow is invoked, the following output is displayed to the console.</span></span>  
  
 <span data-ttu-id="d2dfa-125">**워크플로 시작 합니다.**</span><span class="sxs-lookup"><span data-stu-id="d2dfa-125">**Starting the workflow.**</span></span>  
<span data-ttu-id="d2dfa-126">**CancellationHandler 호출 합니다.** </span><span class="sxs-lookup"><span data-stu-id="d2dfa-126">**CancellationHandler invoked.** </span></span>  
<span data-ttu-id="d2dfa-127">**워크플로 b30ebb30-df46-4d90-a211-e31c38d8db3c 취소 합니다.**</span><span class="sxs-lookup"><span data-stu-id="d2dfa-127">**Workflow b30ebb30-df46-4d90-a211-e31c38d8db3c Canceled.**</span></span>    
> [!NOTE]
>  <span data-ttu-id="d2dfa-128"><xref:System.Activities.Statements.CancellationScope> 활동이 취소되고 <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A>가 호출되는 경우 적절한 취소 논리를 제공하기 위해서는 해당 활동을 취소하기 전에 취소 대상 활동이 얼마나 진행되었는지 워크플로 작성자가 직접 확인해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-128">When a <xref:System.Activities.Statements.CancellationScope> activity is canceled and the <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> invoked, it is the responsibility of the workflow author to determine the progress that the canceled activity made before it was canceled in order to provide the appropriate cancellation logic.</span></span> <span data-ttu-id="d2dfa-129"><xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A>에서는 취소된 활동의 진행률에 대한 어떠한 정보도 제공하지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-129">The <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> does not provide any information about the progress of the canceled activity.</span></span>  
  
 <span data-ttu-id="d2dfa-130">워크플로의 루트를 지난 뒤에 처리되지 않은 예외가 버블링되고 <xref:System.Activities.WorkflowApplication.OnUnhandledException%2A> 처리기가 <xref:System.Activities.UnhandledExceptionAction.Cancel>을 반환하는 경우에도 호스트에서 워크플로를 취소할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-130">A workflow can also be canceled from the host if an unhandled exception bubbles up past the root of the workflow and the <xref:System.Activities.WorkflowApplication.OnUnhandledException%2A> handler returns <xref:System.Activities.UnhandledExceptionAction.Cancel>.</span></span> <span data-ttu-id="d2dfa-131">이 예제에서는 워크플로가 시작된 후 <xref:System.ApplicationException>을 throw합니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-131">In this example the workflow starts and then throws an <xref:System.ApplicationException>.</span></span> <span data-ttu-id="d2dfa-132">이 예외는 워크플로에서 처리되지 않으므로 <xref:System.Activities.WorkflowApplication.OnUnhandledException%2A> 처리기가 호출됩니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-132">This exception is unhandled by the workflow and so the <xref:System.Activities.WorkflowApplication.OnUnhandledException%2A> handler is invoked.</span></span> <span data-ttu-id="d2dfa-133">이 처리기는 워크플로를 취소하도록 런타임에 지시를 내리고, 현재 실행 중인 <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> 활동의 <xref:System.Activities.Statements.CancellationScope>가 호출됩니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-133">The handler instructs the runtime to cancel the workflow, and the <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> of the currently executing <xref:System.Activities.Statements.CancellationScope> activity is invoked.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#36](../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#36)]  
  
 <span data-ttu-id="d2dfa-134">이 워크플로가 호출되면 다음 출력이 콘솔에 표시됩니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-134">When this workflow is invoked, the following output is displayed to the console.</span></span>  
  
 <span data-ttu-id="d2dfa-135">**워크플로 시작 합니다.**</span><span class="sxs-lookup"><span data-stu-id="d2dfa-135">**Starting the workflow.**</span></span>  
<span data-ttu-id="d2dfa-136">**워크플로 6bb2d5d6-f49a-4c6d-a988-478afb86dbe9 OnUnhandledException** </span><span class="sxs-lookup"><span data-stu-id="d2dfa-136">**OnUnhandledException in Workflow 6bb2d5d6-f49a-4c6d-a988-478afb86dbe9** </span></span>  
<span data-ttu-id="d2dfa-137">**ApplicationException throw 되었습니다.** </span><span class="sxs-lookup"><span data-stu-id="d2dfa-137">**An ApplicationException was thrown.** </span></span>  
<span data-ttu-id="d2dfa-138">**CancellationHandler 호출 합니다.** </span><span class="sxs-lookup"><span data-stu-id="d2dfa-138">**CancellationHandler invoked.** </span></span>  
<span data-ttu-id="d2dfa-139">**워크플로 6bb2d5d6-f49a-4c6d-a988-478afb86dbe9 취소 합니다.**</span><span class="sxs-lookup"><span data-stu-id="d2dfa-139">**Workflow 6bb2d5d6-f49a-4c6d-a988-478afb86dbe9 Canceled.**</span></span>    
### <a name="canceling-an-activity-from-inside-a-workflow"></a><span data-ttu-id="d2dfa-140">워크플로 내에서 활동 취소</span><span class="sxs-lookup"><span data-stu-id="d2dfa-140">Canceling an Activity from Inside a Workflow</span></span>  
 <span data-ttu-id="d2dfa-141">활동의 부모를 사용하여 활동을 취소할 수도 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-141">An activity can also be canceled by its parent.</span></span> <span data-ttu-id="d2dfa-142">예를 들어 <xref:System.Activities.Statements.Parallel> 활동에 여러 개의 실행 분기가 있고 해당 <xref:System.Activities.Statements.Parallel.CompletionCondition%2A>이 `true`인 경우 완료되지 않은 분기는 취소됩니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-142">For example, if a <xref:System.Activities.Statements.Parallel> activity has multiple executing branches and its <xref:System.Activities.Statements.Parallel.CompletionCondition%2A> evaluates to `true` then its incomplete branches will be canceled.</span></span> <span data-ttu-id="d2dfa-143">이 예제에서는 분기가 두 개인 <xref:System.Activities.Statements.Parallel> 활동을 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-143">In this example a <xref:System.Activities.Statements.Parallel> activity is created that has two branches.</span></span> <span data-ttu-id="d2dfa-144">이 활동의 <xref:System.Activities.Statements.Parallel.CompletionCondition%2A>이 `true`로 설정되므로 해당 분기 중 하나를 완료하는 즉시 <xref:System.Activities.Statements.Parallel>이 완료됩니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-144">Its <xref:System.Activities.Statements.Parallel.CompletionCondition%2A> is set to `true` so the <xref:System.Activities.Statements.Parallel> completes as soon as any one of its branches is completed.</span></span> <span data-ttu-id="d2dfa-145">이 예제에서는 분기 2가 완료되므로 분기 1이 취소됩니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-145">In this example branch 2 completes, and so branch 1 is canceled.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#37](../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#37)]  
  
 <span data-ttu-id="d2dfa-146">이 워크플로가 호출되면 다음 출력이 콘솔에 표시됩니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-146">When this workflow is invoked, the following output is displayed to the console.</span></span>  
  
 <span data-ttu-id="d2dfa-147">**분기 1 starting.**</span><span class="sxs-lookup"><span data-stu-id="d2dfa-147">**Branch 1 starting.**</span></span>  
<span data-ttu-id="d2dfa-148">**분기 2 complete입니다.** </span><span class="sxs-lookup"><span data-stu-id="d2dfa-148">**Branch 2 complete.** </span></span>  
<span data-ttu-id="d2dfa-149">**분기 1 canceled.** </span><span class="sxs-lookup"><span data-stu-id="d2dfa-149">**Branch 1 canceled.** </span></span>  
<span data-ttu-id="d2dfa-150">**워크플로 e0685e24-18ef-4a47-acf3-5c638732f3be 완료 합니다.**</span><span class="sxs-lookup"><span data-stu-id="d2dfa-150">**Workflow e0685e24-18ef-4a47-acf3-5c638732f3be Completed.**</span></span>  <span data-ttu-id="d2dfa-151">활동의 루트를 지난 뒤에 예외가 버블링되었지만 워크플로의 더 높은 수준에서 해당 예외를 처리하는 경우에도 활동이 취소됩니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-151">Activities are also canceled if an exception bubbles up past the root of the activity but is handled at a higher level in the workflow.</span></span> <span data-ttu-id="d2dfa-152">이 예제에서 워크플로의 주 논리는 <xref:System.Activities.Statements.Sequence> 활동으로 구성되어 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-152">In this example, the main logic of the workflow consists of a <xref:System.Activities.Statements.Sequence> activity.</span></span> <span data-ttu-id="d2dfa-153"><xref:System.Activities.Statements.Sequence>는 <xref:System.Activities.Statements.CancellationScope.Body%2A> 활동에 포함된 <xref:System.Activities.Statements.CancellationScope> 활동의 <xref:System.Activities.Statements.TryCatch>로 지정됩니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-153">The <xref:System.Activities.Statements.Sequence> is specified as the <xref:System.Activities.Statements.CancellationScope.Body%2A> of a <xref:System.Activities.Statements.CancellationScope> activity which is contained by a <xref:System.Activities.Statements.TryCatch> activity.</span></span> <span data-ttu-id="d2dfa-154"><xref:System.Activities.Statements.Sequence>의 본문에서 예외가 throw되면 부모 <xref:System.Activities.Statements.TryCatch> 활동을 통해 해당 예외가 처리되고 <xref:System.Activities.Statements.Sequence>가 취소됩니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-154">An exception is thrown from the body of the <xref:System.Activities.Statements.Sequence>, is handled by the parent <xref:System.Activities.Statements.TryCatch> activity, and the <xref:System.Activities.Statements.Sequence> is canceled.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#39](../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#39)]  
  
 <span data-ttu-id="d2dfa-155">이 워크플로가 호출되면 다음 출력이 콘솔에 표시됩니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-155">When this workflow is invoked, the following output is displayed to the console.</span></span>  
  
 <span data-ttu-id="d2dfa-156">**시작 시퀀스입니다.**</span><span class="sxs-lookup"><span data-stu-id="d2dfa-156">**Sequence starting.**</span></span>  
<span data-ttu-id="d2dfa-157">**취소 하는 시퀀스입니다.** </span><span class="sxs-lookup"><span data-stu-id="d2dfa-157">**Sequence canceled.** </span></span>  
<span data-ttu-id="d2dfa-158">**예외가 발생 했습니다.** </span><span class="sxs-lookup"><span data-stu-id="d2dfa-158">**Exception caught.** </span></span>  
<span data-ttu-id="d2dfa-159">**워크플로 e3c18939-121e-4c43-af1c-ba1ce977ce55 완료 합니다.**</span><span class="sxs-lookup"><span data-stu-id="d2dfa-159">**Workflow e3c18939-121e-4c43-af1c-ba1ce977ce55 Completed.**</span></span>   
### <a name="throwing-exceptions-from-a-cancellationhandler"></a><span data-ttu-id="d2dfa-160">CancellationHandler에서 예외 throw</span><span class="sxs-lookup"><span data-stu-id="d2dfa-160">Throwing Exceptions from a CancellationHandler</span></span>  
 <span data-ttu-id="d2dfa-161"><xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A>의 <xref:System.Activities.Statements.CancellationScope>에서 throw되는 예외는 워크플로에 치명적인 영향을 줍니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-161">Any exceptions thrown from the <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> of a <xref:System.Activities.Statements.CancellationScope> are fatal to the workflow.</span></span> <span data-ttu-id="d2dfa-162"><xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A>에서 예외가 이스케이프될 가능성이 있으면 <xref:System.Activities.Statements.TryCatch>에 <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A>를 사용하여 해당 예외를 catch 및 처리해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-162">If there is a possibility of exceptions escaping from a <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A>, use a <xref:System.Activities.Statements.TryCatch> in the <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> to catch and handle these exceptions.</span></span>  
  
### <a name="cancellation-using-compensableactivity"></a><span data-ttu-id="d2dfa-163">CompensableActivity를 사용한 취소</span><span class="sxs-lookup"><span data-stu-id="d2dfa-163">Cancellation using CompensableActivity</span></span>  
 <span data-ttu-id="d2dfa-164"><xref:System.Activities.Statements.CancellationScope> 활동과 마찬가지로 <xref:System.Activities.Statements.CompensableActivity>에도 <xref:System.Activities.Statements.CompensableActivity.CancellationHandler%2A>가 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-164">Like the <xref:System.Activities.Statements.CancellationScope> activity, the <xref:System.Activities.Statements.CompensableActivity> has a <xref:System.Activities.Statements.CompensableActivity.CancellationHandler%2A>.</span></span> <span data-ttu-id="d2dfa-165"><xref:System.Activities.Statements.CompensableActivity>를 취소하면 해당 <xref:System.Activities.Statements.CompensableActivity.CancellationHandler%2A>의 모든 활동이 호출됩니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-165">If a <xref:System.Activities.Statements.CompensableActivity> is canceled, any activities in its <xref:System.Activities.Statements.CompensableActivity.CancellationHandler%2A> are invoked.</span></span> <span data-ttu-id="d2dfa-166">이는 보정 가능하며 부분적으로 완료된 작업을 실행 취소하는 데 유용할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-166">This can be useful for undoing partially completed compensable work.</span></span> <span data-ttu-id="d2dfa-167">사용 하는 방법에 대 한 내용은 <xref:System.Activities.Statements.CompensableActivity> 보정 및 취소에 대 한 참조 [보정](../../../docs/framework/windows-workflow-foundation/compensation.md)합니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-167">For information about how to use <xref:System.Activities.Statements.CompensableActivity> for compensation and cancellation, see [Compensation](../../../docs/framework/windows-workflow-foundation/compensation.md).</span></span>  
  
## <a name="cancellation-using-custom-activities"></a><span data-ttu-id="d2dfa-168">사용자 지정 활동을 사용한 취소</span><span class="sxs-lookup"><span data-stu-id="d2dfa-168">Cancellation using Custom Activities</span></span>  
 <span data-ttu-id="d2dfa-169">사용자 지정 활동 작성자는 각기 다른 여러 가지 방법으로 사용자 지정 활동에 취소 논리를 구현할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-169">Custom activity authors can implement cancellation logic into their custom activities in several different ways.</span></span> <span data-ttu-id="d2dfa-170"><xref:System.Activities.Activity>에서 파생되는 사용자 지정 활동은 <xref:System.Activities.Statements.CancellationScope> 또는 활동 본문에 취소 논리를 포함하는 다른 사용자 지정 활동을 배치하여 취소 논리를 구현할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-170">Custom activities that derive from <xref:System.Activities.Activity> can implement cancellation logic by placing a <xref:System.Activities.Statements.CancellationScope> or other custom activity that contains cancellation logic in the body of the activity.</span></span> <span data-ttu-id="d2dfa-171"><xref:System.Activities.AsyncCodeActivity> 및 <xref:System.Activities.NativeActivity> 파생 활동은 해당 <xref:System.Activities.NativeActivity.Cancel%2A> 메서드를 재정의하고 취소 논리를 제공할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-171"><xref:System.Activities.AsyncCodeActivity> and <xref:System.Activities.NativeActivity> derived activities can override their respective <xref:System.Activities.NativeActivity.Cancel%2A> method and provide cancellation logic there.</span></span> <span data-ttu-id="d2dfa-172"><xref:System.Activities.CodeActivity> 파생 활동은 런타임에서 <xref:System.Activities.CodeActivity.Execute%2A> 메서드를 호출할 때 한 번 실행으로 모든 작업을 수행하기 때문에 취소를 위한 수단을 제공하지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-172"><xref:System.Activities.CodeActivity> derived activities do not provide any provision for cancellation because all their work is performed in a single burst of execution when the runtime calls the <xref:System.Activities.CodeActivity.Execute%2A> method.</span></span> <span data-ttu-id="d2dfa-173">실행 메서드가 아직 호출되지 않은 상태에서 <xref:System.Activities.CodeActivity> 기반 활동이 취소되는 경우 활동이 <xref:System.Activities.ActivityInstanceState.Canceled> 상태로 닫히고 <xref:System.Activities.CodeActivity.Execute%2A> 메서드는 호출되지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-173">If the execute method has not yet been called and a <xref:System.Activities.CodeActivity> based activity is canceled, the activity closes with a status of <xref:System.Activities.ActivityInstanceState.Canceled> and the <xref:System.Activities.CodeActivity.Execute%2A> method is not called.</span></span>  
  
### <a name="cancellation-using-nativeactivity"></a><span data-ttu-id="d2dfa-174">NativeActivity를 사용한 취소</span><span class="sxs-lookup"><span data-stu-id="d2dfa-174">Cancellation using NativeActivity</span></span>  
 <span data-ttu-id="d2dfa-175"><xref:System.Activities.NativeActivity> 파생 활동에서는 <xref:System.Activities.NativeActivity.Cancel%2A> 메서드를 재정의하여 사용자 지정 취소 논리를 제공할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-175"><xref:System.Activities.NativeActivity> derived activities can override the <xref:System.Activities.NativeActivity.Cancel%2A> method to provide custom cancellation logic.</span></span> <span data-ttu-id="d2dfa-176">이 메서드를 재정의하지 않으면 기본 워크플로 취소 논리가 적용됩니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-176">If this method is not overridden, then the default workflow cancellation logic is applied.</span></span> <span data-ttu-id="d2dfa-177">기본 취소는에 대해 발생 하는 프로세스는 <xref:System.Activities.NativeActivity> 재정의 하지 않습니다는 <xref:System.Activities.NativeActivity.Cancel%2A> 메서드 또는 해당 <xref:System.Activities.NativeActivity.Cancel%2A> 메서드 호출 기본 <xref:System.Activities.NativeActivity> <xref:System.Activities.NativeActivity.Cancel%2A> 메서드.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-177">Default cancellation is the process that occurs for a <xref:System.Activities.NativeActivity> that does not override the <xref:System.Activities.NativeActivity.Cancel%2A> method or whose <xref:System.Activities.NativeActivity.Cancel%2A> method calls the base <xref:System.Activities.NativeActivity> <xref:System.Activities.NativeActivity.Cancel%2A> method.</span></span> <span data-ttu-id="d2dfa-178">활동을 취소하면 런타임에 취소 대상 활동에 대한 플래그가 설정되고 특정 정리 작업이 자동으로 처리됩니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-178">When an activity is canceled, the runtime flags the activity for cancellation and automatically handles certain cleanup.</span></span> <span data-ttu-id="d2dfa-179">활동에서 처리 중인 책갈피만 있으면 책갈피가 제거되고 활동이 <xref:System.Activities.ActivityInstanceState.Canceled>로 표시됩니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-179">If the activity only has outstanding bookmarks, the bookmarks will be removed and the activity will be marked as <xref:System.Activities.ActivityInstanceState.Canceled>.</span></span> <span data-ttu-id="d2dfa-180">취소된 활동에서 처리 중인 자식 활동이 있으면 자식 활동이 차례로 취소됩니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-180">Any outstanding child activities of the canceled activity will in turn be canceled.</span></span> <span data-ttu-id="d2dfa-181">자식 활동을 추가로 예약하려는 시도가 있으면 해당 시도가 무시되고 활동이 <xref:System.Activities.ActivityInstanceState.Canceled>로 표시됩니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-181">Any attempt to schedule additional child activities will result in the attempt being ignored and the activity will be marked as <xref:System.Activities.ActivityInstanceState.Canceled>.</span></span> <span data-ttu-id="d2dfa-182">처리 중이던 자식 활동이 <xref:System.Activities.ActivityInstanceState.Canceled> 또는 <xref:System.Activities.ActivityInstanceState.Faulted> 상태로 완료되면 활동이 <xref:System.Activities.ActivityInstanceState.Canceled>로 표시됩니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-182">If any outstanding child activity completes in the <xref:System.Activities.ActivityInstanceState.Canceled> or <xref:System.Activities.ActivityInstanceState.Faulted> state, then the activity will be marked as <xref:System.Activities.ActivityInstanceState.Canceled>.</span></span> <span data-ttu-id="d2dfa-183">취소 요청은 무시할 수 없습니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-183">Note that a cancellation request can be ignored.</span></span> <span data-ttu-id="d2dfa-184">활동에서 처리 중인 책갈피나 실행 중인 자식 활동이 전혀 없고 취소 플래그가 설정된 후에 작업 항목을 추가로 예약하지도 않는다면 활동이 성공적으로 완료됩니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-184">If an activity does not have any outstanding bookmarks or executing child activities and does not schedule any additional work items after being flagged for cancellation, it will complete successfully.</span></span> <span data-ttu-id="d2dfa-185">대부분의 시나리오에는 이와 같은 기본 취소 프로세스로도 충분합니다. 그러나 취소 논리가 추가로 필요한 경우에는 기본 제공 취소 활동이나 사용자 지정 활동을 사용할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-185">This default cancellation suffices for many scenarios, but if additional cancellation logic is needed, then the built-in cancellation activities or custom activities can be used.</span></span>  
  
 <span data-ttu-id="d2dfa-186">다음 예제에서는 <xref:System.Activities.NativeActivity.Cancel%2A>의 <xref:System.Activities.NativeActivity> 재정의를 기반으로 하는 사용자 지정 `ParallelForEach` 활동을 정의합니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-186">In the following example, the <xref:System.Activities.NativeActivity.Cancel%2A> override of a <xref:System.Activities.NativeActivity> based custom `ParallelForEach` activity is defined.</span></span> <span data-ttu-id="d2dfa-187">활동을 취소하면 이 재정의를 통해 활동의 취소 논리가 처리됩니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-187">When the activity is canceled, this override handles the cancellation logic for the activity.</span></span> <span data-ttu-id="d2dfa-188">이 예제는의 일부는 [비 제네릭 ParallelForEach](../../../docs/framework/windows-workflow-foundation/samples/non-generic-parallelforeach.md) 샘플.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-188">This example is part of the [Non-Generic ParallelForEach](../../../docs/framework/windows-workflow-foundation/samples/non-generic-parallelforeach.md) sample.</span></span>  
  
```csharp  
protected override void Cancel(NativeActivityContext context)  
{  
    // If we do not have a completion condition then we can just  
    // use default logic.  
    if (this.CompletionCondition == null)  
    {  
        base.Cancel(context);  
    }  
    else  
    {  
        context.CancelChildren();  
    }  
}  
```  
  
 <span data-ttu-id="d2dfa-189"><xref:System.Activities.NativeActivity> 파생 활동의 경우 <xref:System.Activities.NativeActivityContext.IsCancellationRequested%2A> 속성을 조사하여 취소가 요청되었는지 여부를 확인하고 <xref:System.Activities.NativeActivityContext.MarkCanceled%2A> 메서드를 호출하여 자신을 취소된 활동으로 표시할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-189"><xref:System.Activities.NativeActivity> derived activities can determine if cancellation has been requested by inspecting the <xref:System.Activities.NativeActivityContext.IsCancellationRequested%2A> property, and mark themselves as canceled by calling the <xref:System.Activities.NativeActivityContext.MarkCanceled%2A> method.</span></span> <span data-ttu-id="d2dfa-190"><xref:System.Activities.NativeActivityContext.MarkCanceled%2A>를 호출한다고 해서 활동이 즉시 완료되지는 않습니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-190">Calling <xref:System.Activities.NativeActivityContext.MarkCanceled%2A> does not immediately complete the activity.</span></span> <span data-ttu-id="d2dfa-191">일반적으로 런타임에서 더 이상 처리 중인 작업이 없을 때 활동이 완료되지만, <xref:System.Activities.NativeActivityContext.MarkCanceled%2A>를 호출한 경우에는 최종 상태가 <xref:System.Activities.ActivityInstanceState.Canceled> 대신 <xref:System.Activities.ActivityInstanceState.Closed>가 됩니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-191">As usual, the runtime will complete the activity when it has no more outstanding work, but if <xref:System.Activities.NativeActivityContext.MarkCanceled%2A> is called the final state will be <xref:System.Activities.ActivityInstanceState.Canceled> instead of <xref:System.Activities.ActivityInstanceState.Closed>.</span></span>  
  
### <a name="cancellation-using-asynccodeactivity"></a><span data-ttu-id="d2dfa-192">AsyncCodeActivity를 사용한 취소</span><span class="sxs-lookup"><span data-stu-id="d2dfa-192">Cancellation using AsyncCodeActivity</span></span>  
 <span data-ttu-id="d2dfa-193"><xref:System.Activities.AsyncCodeActivity> 기반 활동에서도 <xref:System.Activities.AsyncCodeActivity.Cancel%2A> 메서드를 재정의하여 사용자 지정 취소 논리를 제공할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-193"><xref:System.Activities.AsyncCodeActivity> based activities can also provide custom cancellation logic by overriding the <xref:System.Activities.AsyncCodeActivity.Cancel%2A> method.</span></span> <span data-ttu-id="d2dfa-194">이 메서드를 재정의하지 않은 경우 활동이 취소되지 않으면 취소 처리도 수행되지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-194">If this method is not overridden, then no cancellation handling is performed if the activity is canceled.</span></span> <span data-ttu-id="d2dfa-195">다음 예제에서는 <xref:System.Activities.AsyncCodeActivity.Cancel%2A>의 <xref:System.Activities.AsyncCodeActivity> 재정의를 기반으로 하는 사용자 지정 `ExecutePowerShell` 활동을 정의합니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-195">In the following example, the <xref:System.Activities.AsyncCodeActivity.Cancel%2A> override of an <xref:System.Activities.AsyncCodeActivity> based custom `ExecutePowerShell` activity is defined.</span></span> <span data-ttu-id="d2dfa-196">활동을 취소하면 필요한 취소 동작이 수행됩니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-196">When the activity is canceled, it performs the desired cancellation behavior.</span></span> <span data-ttu-id="d2dfa-197">이 예제는의 일부는 [InvokePowerShell 활동을 사용 하 여](../../../docs/framework/windows-workflow-foundation/samples/using-the-invokepowershell-activity.md) 샘플.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-197">This example is part of the [Using the InvokePowerShell Activity](../../../docs/framework/windows-workflow-foundation/samples/using-the-invokepowershell-activity.md) sample.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#1020](../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#1020)]  
  
 <span data-ttu-id="d2dfa-198"><xref:System.Activities.AsyncCodeActivity> 파생 활동의 경우 <xref:System.Activities.AsyncCodeActivityContext.IsCancellationRequested%2A> 속성을 조사하여 취소가 요청되었는지 여부를 확인하고 <xref:System.Activities.AsyncCodeActivityContext.MarkCanceled%2A> 메서드를 호출하여 자신을 취소된 활동으로 표시할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="d2dfa-198"><xref:System.Activities.AsyncCodeActivity> derived activities can determine if cancellation has been requested by inspecting the <xref:System.Activities.AsyncCodeActivityContext.IsCancellationRequested%2A> property, and mark themselves as canceled by calling the <xref:System.Activities.AsyncCodeActivityContext.MarkCanceled%2A> method.</span></span>

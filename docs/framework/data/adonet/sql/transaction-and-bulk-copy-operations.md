---
title: 트랜잭션 및 대량 복사 작업
ms.custom: ''
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: ''
ms.suite: ''
ms.technology:
- dotnet-ado
ms.tgt_pltfrm: ''
ms.topic: article
dev_langs:
- csharp
- vb
ms.assetid: f6f0cbc9-f7bf-4d6e-875f-ad1ba0b4aa62
caps.latest.revision: 4
author: douglaslMS
ms.author: douglasl
manager: craigg
ms.workload:
- dotnet
ms.openlocfilehash: 40494c887ffa48c6ebc7f020cb4d42eecbd08e75
ms.sourcegitcommit: 86adcc06e35390f13c1e372c36d2e044f1fc31ef
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 04/26/2018
---
# <a name="transaction-and-bulk-copy-operations"></a><span data-ttu-id="a3374-102">트랜잭션 및 대량 복사 작업</span><span class="sxs-lookup"><span data-stu-id="a3374-102">Transaction and Bulk Copy Operations</span></span>
<span data-ttu-id="a3374-103">대량 복사 작업을 격리된 작업이나 여러 단계로 이루어진 트랜잭션의 일부로 수행할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a3374-103">Bulk copy operations can be performed as isolated operations or as part of a multiple step transaction.</span></span> <span data-ttu-id="a3374-104">후자를 사용하면 다른 데이터베이스 작업(삽입, 업데이트, 삭제 등)을 수행하면서 같은 트랜잭션 내에서 둘 이상의 대량 복사 작업을 수행할 수 있을 뿐만 아니라 전체 트랜잭션을 커밋하거나 롤백할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a3374-104">This latter option enables you to perform more than one bulk copy operation within the same transaction, as well as perform other database operations (such as inserts, updates, and deletes) while still being able to commit or roll back the entire transaction.</span></span>  
  
 <span data-ttu-id="a3374-105">기본적으로 대량 복사 작업은 격리된 작업으로 수행됩니다.</span><span class="sxs-lookup"><span data-stu-id="a3374-105">By default, a bulk copy operation is performed as an isolated operation.</span></span> <span data-ttu-id="a3374-106">대량 복사 작업은 롤백할 수 없는 비트랜잭트 방식으로 이루어집니다.</span><span class="sxs-lookup"><span data-stu-id="a3374-106">The bulk copy operation occurs in a non-transacted way, with no opportunity for rolling it back.</span></span> <span data-ttu-id="a3374-107">롤백할 전체 또는 대량 복사의 일부 오류가 발생 해야 하는 경우 사용할 수 있습니다는 <xref:System.Data.SqlClient.SqlBulkCopy>-관리 되는 트랜잭션을, 기존 트랜잭션 내에서 대량 복사 작업을 수행할 또는 참여 한 **System.Transactions** <xref:System.Transactions.Transaction>.</span><span class="sxs-lookup"><span data-stu-id="a3374-107">If you need to roll back all or part of the bulk copy when an error occurs, you can use a <xref:System.Data.SqlClient.SqlBulkCopy>-managed transaction, perform the bulk copy operation within an existing transaction, or be enlisted in a **System.Transactions**<xref:System.Transactions.Transaction>.</span></span>  
  
## <a name="performing-a-non-transacted-bulk-copy-operation"></a><span data-ttu-id="a3374-108">비트랜잭트 대량 복사 작업 수행</span><span class="sxs-lookup"><span data-stu-id="a3374-108">Performing a Non-transacted Bulk Copy Operation</span></span>  
 <span data-ttu-id="a3374-109">다음 콘솔 응용 프로그램은 비트랜잭트 대량 복사 작업에서 작업 중에 오류가 발생하는 경우를 보여 줍니다.</span><span class="sxs-lookup"><span data-stu-id="a3374-109">The following Console application shows what happens when a non-transacted bulk copy operation encounters an error partway through the operation.</span></span>  
  
 <span data-ttu-id="a3374-110">예제에서는 원본 테이블 및 대상 테이블에는 각 포함 된 `Identity` 라는 열 **ProductID**합니다.</span><span class="sxs-lookup"><span data-stu-id="a3374-110">In the example, the source table and destination table each include an `Identity` column named **ProductID**.</span></span> <span data-ttu-id="a3374-111">먼저 코드는 모든 행을 삭제 하 여 대상 테이블을 준비 하 고 행을 단일을 삽입 한 다음 **ProductID** 원본 테이블에 없는 것으로 알려져 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a3374-111">The code first prepares the destination table by deleting all rows and then inserting a single row whose **ProductID** is known to exist in the source table.</span></span> <span data-ttu-id="a3374-112">기본적으로 `Identity` 열의 새 값이 대상 테이블의 추가된 행마다 생성됩니다.</span><span class="sxs-lookup"><span data-stu-id="a3374-112">By default, a new value for the `Identity` column is generated in the destination table for each row added.</span></span> <span data-ttu-id="a3374-113">이 예제에서는 연결이 열려 있기 때문에 대량 로드 프로세스에서 소스 테이블의 `Identity` 값을 대신 강제로 사용해야 하는 경우에 옵션이 설정됩니다.</span><span class="sxs-lookup"><span data-stu-id="a3374-113">In this example, an option is set when the connection is opened that forces the bulk load process to use the `Identity` values from the source table instead.</span></span>  
  
 <span data-ttu-id="a3374-114">대량 복사 작업은 <xref:System.Data.SqlClient.SqlBulkCopy.BatchSize%2A> 속성을 10으로 설정하여 실행합니다.</span><span class="sxs-lookup"><span data-stu-id="a3374-114">The bulk copy operation is executed with the <xref:System.Data.SqlClient.SqlBulkCopy.BatchSize%2A> property set to 10.</span></span> <span data-ttu-id="a3374-115">작업 중 올바르지 않은 행이 발견되면 예외가 throw됩니다.</span><span class="sxs-lookup"><span data-stu-id="a3374-115">When the operation encounters the invalid row, an exception is thrown.</span></span> <span data-ttu-id="a3374-116">이 첫 번째 예제에서 대량 복사 작업은 비트랜잭트 방식입니다.</span><span class="sxs-lookup"><span data-stu-id="a3374-116">In this first example, the bulk copy operation is non-transacted.</span></span> <span data-ttu-id="a3374-117">오류 지점까지 복사한 모든 배치가 커밋되어, 중복 키를 포함하는 배치가 롤백되고 다른 모든 배치가 처리될 때까지 대량 복사 작업이 중지됩니다.</span><span class="sxs-lookup"><span data-stu-id="a3374-117">All batches copied up to the point of the error are committed; the batch containing the duplicate key is rolled back, and the bulk copy operation is halted before processing any other batches.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="a3374-118">이 샘플을 만들지 않은 경우 작업 테이블에 설명 된 대로 실행 되지 것입니다 [대량 복사 예제 설정](../../../../../docs/framework/data/adonet/sql/bulk-copy-example-setup.md)합니다.</span><span class="sxs-lookup"><span data-stu-id="a3374-118">This sample will not run unless you have created the work tables as described in [Bulk Copy Example Setup](../../../../../docs/framework/data/adonet/sql/bulk-copy-example-setup.md).</span></span> <span data-ttu-id="a3374-119">이 코드는 사용 하는 구문을 보여 주기 위해 제공 됩니다 **SqlBulkCopy** 만 합니다.</span><span class="sxs-lookup"><span data-stu-id="a3374-119">This code is provided to demonstrate the syntax for using **SqlBulkCopy** only.</span></span> <span data-ttu-id="a3374-120">더 쉽고 빠르게 사용할 소스 및 대상 테이블이 동일한 SQL Server 인스턴스에 있으면는 [!INCLUDE[tsql](../../../../../includes/tsql-md.md)] `INSERT … SELECT` 문의 데이터를 복사 합니다.</span><span class="sxs-lookup"><span data-stu-id="a3374-120">If the source and destination tables are located in the same SQL Server instance, it is easier and faster to use a [!INCLUDE[tsql](../../../../../includes/tsql-md.md)]`INSERT … SELECT` statement to copy the data.</span></span>  
  
 [!code-csharp[DataWorks SqlBulkCopy.DefaultTransaction#1](../../../../../samples/snippets/csharp/VS_Snippets_ADO.NET/DataWorks SqlBulkCopy.DefaultTransaction/CS/source.cs#1)]
 [!code-vb[DataWorks SqlBulkCopy.DefaultTransaction#1](../../../../../samples/snippets/visualbasic/VS_Snippets_ADO.NET/DataWorks SqlBulkCopy.DefaultTransaction/VB/source.vb#1)]  
  
## <a name="performing-a-dedicated-bulk-copy-operation-in-a-transaction"></a><span data-ttu-id="a3374-121">트랜잭션에서 전용 대량 복사 작업 수행</span><span class="sxs-lookup"><span data-stu-id="a3374-121">Performing a Dedicated Bulk Copy Operation in a Transaction</span></span>  
 <span data-ttu-id="a3374-122">기본적으로 대량 복사 작업은 그 자체만으로도 고유한 트랜잭션입니다.</span><span class="sxs-lookup"><span data-stu-id="a3374-122">By default, a bulk copy operation is its own transaction.</span></span> <span data-ttu-id="a3374-123">전용 대량 복사 작업을 수행하려면 연결 문자열을 사용하여 <xref:System.Data.SqlClient.SqlBulkCopy>의 새 인스턴스를 만들거나 활성 트랜잭션 없이 기존 <xref:System.Data.SqlClient.SqlConnection> 개체를 사용합니다.</span><span class="sxs-lookup"><span data-stu-id="a3374-123">When you want to perform a dedicated bulk copy operation, create a new instance of <xref:System.Data.SqlClient.SqlBulkCopy> with a connection string, or use an existing <xref:System.Data.SqlClient.SqlConnection> object without an active transaction.</span></span> <span data-ttu-id="a3374-124">각 시나리오에서는 대량 복사 작업이 만들어진 후 트랜잭션이 커밋되거나 롤백됩니다.</span><span class="sxs-lookup"><span data-stu-id="a3374-124">In each scenario, the bulk copy operation creates, and then commits or rolls back the transaction.</span></span>  
  
 <span data-ttu-id="a3374-125"><xref:System.Data.SqlClient.SqlBulkCopyOptions.UseInternalTransaction> 클래스 생성자에서 <xref:System.Data.SqlClient.SqlBulkCopy> 옵션을 명시적으로 지정하여 대량 복사 작업이 자체 트랜잭션에서 실행되도록 명시적으로 지정함으로써 대량 복사 작업의 각 배치가 별도의 트랜잭션 내에서 실행되도록 할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a3374-125">You can explicitly specify the <xref:System.Data.SqlClient.SqlBulkCopyOptions.UseInternalTransaction> option in the <xref:System.Data.SqlClient.SqlBulkCopy> class constructor to explicitly cause a bulk copy operation to execute in its own transaction, causing each batch of the bulk copy operation to execute within a separate transaction.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="a3374-126">배치가 실행되는 트랜잭션이 각각 다르기 때문에 대량 복사 작업 중에 오류가 발생할 경우 현재 배치 내의 모든 행이 롤백되지만 이전 배치의 행은 데이터베이스에 유지됩니다.</span><span class="sxs-lookup"><span data-stu-id="a3374-126">Since different batches are executed in different transactions, if an error occurs during the bulk copy operation, all the rows in the current batch will be rolled back, but rows from previous batches will remain in the database.</span></span>  
  
 <span data-ttu-id="a3374-127">다음 콘솔 응용 프로그램은 다음 한 가지를 제외하면 앞의 예제와 유사합니다. 이 예제에서 대량 복사 작업은 고유 트랜잭션을 관리합니다.</span><span class="sxs-lookup"><span data-stu-id="a3374-127">The following console application is similar to the previous example, with one exception: In this example, the bulk copy operation manages its own transactions.</span></span> <span data-ttu-id="a3374-128">오류 지점까지 복사한 모든 배치가 커밋되어, 중복 키를 포함하는 배치가 롤백되고 다른 모든 배치가 처리될 때까지 대량 복사 작업이 중지됩니다.</span><span class="sxs-lookup"><span data-stu-id="a3374-128">All batches copied up to the point of the error are committed; the batch containing the duplicate key is rolled back, and the bulk copy operation is halted before processing any other batches.</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="a3374-129">이 샘플을 만들지 않은 경우 작업 테이블에 설명 된 대로 실행 되지 것입니다 [대량 복사 예제 설정](../../../../../docs/framework/data/adonet/sql/bulk-copy-example-setup.md)합니다.</span><span class="sxs-lookup"><span data-stu-id="a3374-129">This sample will not run unless you have created the work tables as described in [Bulk Copy Example Setup](../../../../../docs/framework/data/adonet/sql/bulk-copy-example-setup.md).</span></span> <span data-ttu-id="a3374-130">이 코드는 사용 하는 구문을 보여 주기 위해 제공 됩니다 **SqlBulkCopy** 만 합니다.</span><span class="sxs-lookup"><span data-stu-id="a3374-130">This code is provided to demonstrate the syntax for using **SqlBulkCopy** only.</span></span> <span data-ttu-id="a3374-131">더 쉽고 빠르게 사용할 소스 및 대상 테이블이 동일한 SQL Server 인스턴스에 있으면는 [!INCLUDE[tsql](../../../../../includes/tsql-md.md)] `INSERT … SELECT` 문의 데이터를 복사 합니다.</span><span class="sxs-lookup"><span data-stu-id="a3374-131">If the source and destination tables are located in the same SQL Server instance, it is easier and faster to use a [!INCLUDE[tsql](../../../../../includes/tsql-md.md)]`INSERT … SELECT` statement to copy the data.</span></span>  
  
 [!code-csharp[DataWorks SqlBulkCopy.InternalTransaction#1](../../../../../samples/snippets/csharp/VS_Snippets_ADO.NET/DataWorks SqlBulkCopy.InternalTransaction/CS/source.cs#1)]
 [!code-vb[DataWorks SqlBulkCopy.InternalTransaction#1](../../../../../samples/snippets/visualbasic/VS_Snippets_ADO.NET/DataWorks SqlBulkCopy.InternalTransaction/VB/source.vb#1)]  
  
## <a name="using-existing-transactions"></a><span data-ttu-id="a3374-132">기존 트랜잭션 사용</span><span class="sxs-lookup"><span data-stu-id="a3374-132">Using Existing Transactions</span></span>  
 <span data-ttu-id="a3374-133">기존 <xref:System.Data.SqlClient.SqlTransaction> 개체를 <xref:System.Data.SqlClient.SqlBulkCopy> 생성자의 매개 변수로 지정할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a3374-133">You can specify an existing <xref:System.Data.SqlClient.SqlTransaction> object as a parameter in a <xref:System.Data.SqlClient.SqlBulkCopy> constructor.</span></span> <span data-ttu-id="a3374-134">이 경우, 대량 복사 작업은 기존 트랜잭션에서 수행되며 트랜잭션 상태는 변경되지 않습니다. 즉, 커밋되거나 중단되지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="a3374-134">In this situation, the bulk copy operation is performed in an existing transaction, and no change is made to the transaction state (that is, it is neither committed nor aborted).</span></span> <span data-ttu-id="a3374-135">따라서 응용 프로그램에서 다른 데이터베이스 작업과 함께 대량 복사 작업을 하나의 트랜잭션에 포함시킬 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a3374-135">This allows an application to include the bulk copy operation in a transaction with other database operations.</span></span> <span data-ttu-id="a3374-136">그러나 <xref:System.Data.SqlClient.SqlTransaction> 개체를 지정하지 않고 null 참조를 전달하며 연결에 활성 트랜잭션이 있는 경우에는 예외가 throw됩니다.</span><span class="sxs-lookup"><span data-stu-id="a3374-136">However, if you do not specify a <xref:System.Data.SqlClient.SqlTransaction> object and pass a null reference, and the connection has an active transaction, an exception is thrown.</span></span>  
  
 <span data-ttu-id="a3374-137">오류가 발생하여 전체 대량 복사 작업을 롤백해야 하는 경우나 롤백할 수 있는 보다 큰 프로세스의 일부로 대량 복사를 실행해야 하는 경우에는 <xref:System.Data.SqlClient.SqlTransaction> 개체를 <xref:System.Data.SqlClient.SqlBulkCopy> 생성자에 제공할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="a3374-137">If you need to roll back the entire bulk copy operation because an error occurs, or if the bulk copy should execute as part of a larger process that can be rolled back, you can provide a <xref:System.Data.SqlClient.SqlTransaction> object to the <xref:System.Data.SqlClient.SqlBulkCopy> constructor.</span></span>  
  
 <span data-ttu-id="a3374-138">다음 콘솔 응용 프로그램은 다음 한 가지를 제외하면 첫 번째(비트랜잭트 방식) 예제와 유사합니다. 이 예제에서는 대량 복사 작업이 보다 큰 외부 트랜잭션에 포함됩니다.</span><span class="sxs-lookup"><span data-stu-id="a3374-138">The following console application is similar to the first (non-transacted) example, with one exception: in this example, the bulk copy operation is included in a larger, external transaction.</span></span> <span data-ttu-id="a3374-139">기본 키 위반 오류가 발생하는 경우에는 전체 트랜잭션이 롤백되고 대상 테이블에 행이 추가되지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="a3374-139">When the primary key violation error occurs, the entire transaction is rolled back and no rows are added to the destination table.</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="a3374-140">이 샘플을 만들지 않은 경우 작업 테이블에 설명 된 대로 실행 되지 것입니다 [대량 복사 예제 설정](../../../../../docs/framework/data/adonet/sql/bulk-copy-example-setup.md)합니다.</span><span class="sxs-lookup"><span data-stu-id="a3374-140">This sample will not run unless you have created the work tables as described in [Bulk Copy Example Setup](../../../../../docs/framework/data/adonet/sql/bulk-copy-example-setup.md).</span></span> <span data-ttu-id="a3374-141">이 코드는 사용 하는 구문을 보여 주기 위해 제공 됩니다 **SqlBulkCopy** 만 합니다.</span><span class="sxs-lookup"><span data-stu-id="a3374-141">This code is provided to demonstrate the syntax for using **SqlBulkCopy** only.</span></span> <span data-ttu-id="a3374-142">더 쉽고 빠르게 사용할 소스 및 대상 테이블이 동일한 SQL Server 인스턴스에 있으면는 [!INCLUDE[tsql](../../../../../includes/tsql-md.md)] `INSERT … SELECT` 문의 데이터를 복사 합니다.</span><span class="sxs-lookup"><span data-stu-id="a3374-142">If the source and destination tables are located in the same SQL Server instance, it is easier and faster to use a [!INCLUDE[tsql](../../../../../includes/tsql-md.md)]`INSERT … SELECT` statement to copy the data.</span></span>  
  
 [!code-csharp[DataWorks SqlBulkCopy.SqlTransaction#1](../../../../../samples/snippets/csharp/VS_Snippets_ADO.NET/DataWorks SqlBulkCopy.SqlTransaction/CS/source.cs#1)]
 [!code-vb[DataWorks SqlBulkCopy.SqlTransaction#1](../../../../../samples/snippets/visualbasic/VS_Snippets_ADO.NET/DataWorks SqlBulkCopy.SqlTransaction/VB/source.vb#1)]  
  
## <a name="see-also"></a><span data-ttu-id="a3374-143">참고 항목</span><span class="sxs-lookup"><span data-stu-id="a3374-143">See Also</span></span>  
 [<span data-ttu-id="a3374-144">SQL Server에서 대량 복사 작업</span><span class="sxs-lookup"><span data-stu-id="a3374-144">Bulk Copy Operations in SQL Server</span></span>](../../../../../docs/framework/data/adonet/sql/bulk-copy-operations-in-sql-server.md)  
 [<span data-ttu-id="a3374-145">ADO.NET 관리되는 공급자 및 데이터 집합 개발자 센터</span><span class="sxs-lookup"><span data-stu-id="a3374-145">ADO.NET Managed Providers and DataSet Developer Center</span></span>](http://go.microsoft.com/fwlink/?LinkId=217917)

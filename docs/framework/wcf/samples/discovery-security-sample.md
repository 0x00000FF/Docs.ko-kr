---
title: Discovery Security 샘플
ms.date: 03/30/2017
ms.assetid: b8db01f4-b4a1-43fe-8e31-26d4e9304a65
ms.openlocfilehash: 00f81d1879d9157a7ecdfa0db8d2ea0d505ad5b6
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 03/12/2020
ms.locfileid: "79183735"
---
# <a name="discovery-security-sample"></a><span data-ttu-id="12cb9-102">Discovery Security 샘플</span><span class="sxs-lookup"><span data-stu-id="12cb9-102">Discovery Security Sample</span></span>

<span data-ttu-id="12cb9-103">검색 사양에서는 검색 프로세스에 참여하는 엔드포인트를 보호하도록 요구하지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="12cb9-103">The Discovery specification does not require that endpoints that participate in the discovery process to be secure.</span></span> <span data-ttu-id="12cb9-104">그러나 검색 메시지의 보안을 강화하면 메시지 변경, 서비스 거부, 재생, 스푸핑 같은 다양한 형식의 공격을 완화할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="12cb9-104">Enhancing the discovery messages with security mitigates various types of attacks (message alteration, denial of service, replay, spoofing).</span></span> <span data-ttu-id="12cb9-105">이 샘플에서는 WS-Discovery 사양의 8.2단원에 설명된 압축 서명 형식을 사용하여 메시지 서명을 컴퓨팅 및 확인하는 사용자 지정 채널을 구현합니다.</span><span class="sxs-lookup"><span data-stu-id="12cb9-105">This sample implements custom channels that compute and verify message signatures using the compact signature format (described in Section 8.2 of the WS-Discovery specification).</span></span> <span data-ttu-id="12cb9-106">샘플은 [2005 검색 사양과](http://specs.xmlsoap.org/ws/2005/04/discovery/ws-discovery.pdf) [1.1 버전을](http://docs.oasis-open.org/ws-dd/discovery/1.1/cs-01/wsdd-discovery-1.1-spec-cs-01.pdf)모두 지원합니다.</span><span class="sxs-lookup"><span data-stu-id="12cb9-106">The sample supports both the [2005 Discovery specification](http://specs.xmlsoap.org/ws/2005/04/discovery/ws-discovery.pdf) and the [1.1 version](http://docs.oasis-open.org/ws-dd/discovery/1.1/cs-01/wsdd-discovery-1.1-spec-cs-01.pdf).</span></span>  
  
 <span data-ttu-id="12cb9-107">사용자 지정 채널은 검색 및 알림 엔드포인트의 기존 채널 스택 맨 위에서 적용됩니다.</span><span class="sxs-lookup"><span data-stu-id="12cb9-107">The custom channel is applied on top of the existing channel stack for Discovery and Announcement endpoints.</span></span> <span data-ttu-id="12cb9-108">이렇게 하면 서명 헤더가 보내는 모든 메시지에 적용됩니다.</span><span class="sxs-lookup"><span data-stu-id="12cb9-108">This way, a signature header is applied for every message sent.</span></span> <span data-ttu-id="12cb9-109">서명은 받은 메시지에서 확인되며 서명이 일치하지 않거나 서명이 없는 메시지는 삭제됩니다.</span><span class="sxs-lookup"><span data-stu-id="12cb9-109">The signature is verified on received messages and when it does not match or when the messages do not have a signature, the messages are dropped.</span></span> <span data-ttu-id="12cb9-110">메시지 서명 및 확인을 위해 이 샘플에서는 인증서를 사용합니다.</span><span class="sxs-lookup"><span data-stu-id="12cb9-110">To sign and verify messages, the sample uses certificates.</span></span>  
  
## <a name="discussion"></a><span data-ttu-id="12cb9-111">토론</span><span class="sxs-lookup"><span data-stu-id="12cb9-111">Discussion</span></span>  
 <span data-ttu-id="12cb9-112">WCF는 확장성이 우수하므로 사용자가 채널을 원하는 대로 사용자 지정할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="12cb9-112">WCF is very extensible and allows users the possibility to customize channels as desired.</span></span> <span data-ttu-id="12cb9-113">이 샘플에서는 보안 채널을 빌드하는 검색 보안 바인딩 요소를 구현합니다.</span><span class="sxs-lookup"><span data-stu-id="12cb9-113">The sample implements a discovery secure binding element that builds secure channels.</span></span> <span data-ttu-id="12cb9-114">보안 채널에서는 메시지 서명을 적용 및 확인하며 현재 스택의 맨 위에서 적용됩니다.</span><span class="sxs-lookup"><span data-stu-id="12cb9-114">The secure channels apply and verify message signatures and are applied on top of the current stack.</span></span>  
  
 <span data-ttu-id="12cb9-115">보안 바인딩 요소는 보안 채널 팩터리 및 채널 수신기를 빌드합니다.</span><span class="sxs-lookup"><span data-stu-id="12cb9-115">The secure binding element builds secure channel factories and channel listeners.</span></span>  
  
## <a name="secure-channel-factory"></a><span data-ttu-id="12cb9-116">보안 채널 팩터리</span><span class="sxs-lookup"><span data-stu-id="12cb9-116">Secure Channel Factory</span></span>  
 <span data-ttu-id="12cb9-117">보안 채널 팩터리는 메시지 헤더에 압축 서명을 추가하는 이중 채널 또는 출력을 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="12cb9-117">The secure channel factory creates output or duplex channels that add a compact signature to message headers.</span></span> <span data-ttu-id="12cb9-118">메시지를 가능한 한 작게 유지하기 위해 압축 서명 형식이 사용됩니다.</span><span class="sxs-lookup"><span data-stu-id="12cb9-118">To keep messages as small as possible the compact signature format is used.</span></span> <span data-ttu-id="12cb9-119">다음 예제에서는 압축 서명의 구조를 보여 줍니다.</span><span class="sxs-lookup"><span data-stu-id="12cb9-119">The structure of a compact signature is shown in the following example.</span></span>  
  
```xml  
<d:Security ... >
  [<d:Sig Scheme="xs:anyURI"
         [KeyId="xs:base64Binary"]?  
          Refs="..."  
         [PrefixList]="xs:NMTOKENS"
          Sig="xs:base64Binary"
          ... />]?  
  ...
</d:Security>  
```  
  
> [!NOTE]
> <span data-ttu-id="12cb9-120">2008 검색 버전 프로토콜에는 `PrefixList`가 추가되었습니다.</span><span class="sxs-lookup"><span data-stu-id="12cb9-120">The `PrefixList` was added in the 2008 Discovery version protocol.</span></span>  
  
 <span data-ttu-id="12cb9-121">서명을 컴퓨팅하기 위해 이 샘플에서는 확장된 서명 항목을 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="12cb9-121">To compute the signature, the sample determines the expanded signature items.</span></span> <span data-ttu-id="12cb9-122">XML 서명(`SignedInfo`)은 WS-Discovery 사양에서 요구하는 대로 `ds` 네임스페이스 접두사를 사용하여 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="12cb9-122">An XML signature (`SignedInfo`) is created, using the `ds` namespace prefix, as required by the WS-Discovery specification.</span></span> <span data-ttu-id="12cb9-123">검색 및 주소 지정 네임스페이스의 본문과 모든 헤더는 서명에서 참조되므로 변경할 수 없습니다.</span><span class="sxs-lookup"><span data-stu-id="12cb9-123">The body and all the headers in discovery and addressing namespaces are referenced in the signature, so they cannot be tampered with.</span></span> <span data-ttu-id="12cb9-124">참조된 각 요소는 단독 표준화()를http://www.w3.org/2001/10/xml-exc-c14n# 사용하여 변환된 다음 SHA-1 다이제스트 값이 계산됩니다(http://www.w3.org/2000/09/xmldsig#sha1 ).</span><span class="sxs-lookup"><span data-stu-id="12cb9-124">Each referenced element is transformed using the Exclusive Canonicalization (http://www.w3.org/2001/10/xml-exc-c14n# ), and then an SHA-1 digest value is computed (http://www.w3.org/2000/09/xmldsig#sha1 ).</span></span> <span data-ttu-id="12cb9-125">참조된 모든 요소와 해당 다이제스트 값을 기반으로 서명 값은http://www.w3.org/2000/09/xmldsig#rsa-sha1 RSA 알고리즘()을 사용하여 계산됩니다.</span><span class="sxs-lookup"><span data-stu-id="12cb9-125">Based on all referenced elements and their digest values, the signature value is computed using the RSA algorithm (http://www.w3.org/2000/09/xmldsig#rsa-sha1 ).</span></span>  
  
 <span data-ttu-id="12cb9-126">메시지는 클라이언트에서 지정한 인증서를 사용하여 서명됩니다.</span><span class="sxs-lookup"><span data-stu-id="12cb9-126">The messages are signed with a client-specified certificate.</span></span> <span data-ttu-id="12cb9-127">저장소 위치, 이름 및 인증서 주체 이름은 바인딩 요소를 만들 때 지정해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="12cb9-127">The store location, name and the certificate subject name must be specified when the binding element is created.</span></span> <span data-ttu-id="12cb9-128">압축 서명의 `KeyId`는 서명 토큰의 키 식별자를 나타내며 서명 토큰의 SKI(주체 키 식별자)나 서명 토큰의 공개 키에 대한 SHA-1 해시(SKI가 없는 경우)입니다.</span><span class="sxs-lookup"><span data-stu-id="12cb9-128">The `KeyId` in the compact signature represents the key identifier of the signing token and is the Subject Key Identifier (SKI) of the signing token or (if the SKI does not exist) a SHA-1 hash of the public key of the signing token.</span></span>  
  
## <a name="secure-channel-listener"></a><span data-ttu-id="12cb9-129">보안 채널 수신기</span><span class="sxs-lookup"><span data-stu-id="12cb9-129">Secure Channel Listener</span></span>  
 <span data-ttu-id="12cb9-130">보안 채널 수신기에서는 받은 메시지의 압축 서명을 확인하는 이중 채널 또는 입력을 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="12cb9-130">The secure channel listener creates input or duplex channels that verify the compact signature in received messages.</span></span> <span data-ttu-id="12cb9-131">서명을 확인하려면 메시지에 첨부된 압축 서명에 지정된 `KeyId`를 사용하여 지정된 저장소에서 인증서를 선택합니다.</span><span class="sxs-lookup"><span data-stu-id="12cb9-131">To verify the signature, the `KeyId` specified in the compact signature attached to the message is used to select a certificate from the specified store.</span></span> <span data-ttu-id="12cb9-132">서명이 없거나 서명 확인에 실패한 메시지는 삭제됩니다.</span><span class="sxs-lookup"><span data-stu-id="12cb9-132">If the message does not have a signature or the signature check fails, the messages are dropped.</span></span> <span data-ttu-id="12cb9-133">보안 바인딩을 사용하기 위해 이 샘플에서는 추가된 검색 보안 바인딩 요소를 사용하여 사용자 지정 <xref:System.ServiceModel.Discovery.UdpDiscoveryEndpoint> 및 <xref:System.ServiceModel.Discovery.UdpAnnouncementEndpoint>를 만드는 팩터리를 정의합니다.</span><span class="sxs-lookup"><span data-stu-id="12cb9-133">To use the secure binding, the sample defines a factory that creates custom <xref:System.ServiceModel.Discovery.UdpDiscoveryEndpoint> and <xref:System.ServiceModel.Discovery.UdpAnnouncementEndpoint> with the added discovery secure binding element.</span></span> <span data-ttu-id="12cb9-134">이 보안 엔드포인트는 검색 알림 수신기와 검색 가능한 서비스에서 사용할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="12cb9-134">These secure endpoints can be used in discovery announcement listeners and discoverable services.</span></span>  
  
## <a name="sample-details"></a><span data-ttu-id="12cb9-135">샘플 세부 정보</span><span class="sxs-lookup"><span data-stu-id="12cb9-135">Sample Details</span></span>  
 <span data-ttu-id="12cb9-136">이 샘플에는 한 개의 라이브러리와 네 개의 콘솔 애플리케이션이 포함되어 있습니다.</span><span class="sxs-lookup"><span data-stu-id="12cb9-136">The sample includes a library and 4 console applications:</span></span>  
  
- <span data-ttu-id="12cb9-137">**디스커버리시큐리티채널**: 보안 바인딩을 노출하는 라이브러리입니다.</span><span class="sxs-lookup"><span data-stu-id="12cb9-137">**DiscoverySecurityChannels**: A library that exposes the secure binding.</span></span> <span data-ttu-id="12cb9-138">라이브러리에서는 들어오고 나가는 메시지의 압축 서명을 계산하고 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="12cb9-138">The library computes and verifies the compact signature for outgoing/incoming messages.</span></span>  
  
- <span data-ttu-id="12cb9-139">**서비스**: 자체 호스팅된 ICalculatorService 계약을 노출하는 서비스입니다.</span><span class="sxs-lookup"><span data-stu-id="12cb9-139">**Service**: A service exposing ICalculatorService contract, self hosted.</span></span> <span data-ttu-id="12cb9-140">이 서비스는 검색 가능한 것으로 표시됩니다.</span><span class="sxs-lookup"><span data-stu-id="12cb9-140">The service is marked as Discoverable.</span></span> <span data-ttu-id="12cb9-141">사용자는 인증서에 대한 저장소 위치, 이름, 주체 이름 또는 기타 고유 식별자와 클라이언트 인증서(들어오는 메시지의 서명을 확인하는 데 사용되는 인증서)가 있는 저장소를 지정하여 메시지에 서명하는 데 사용되는 인증서의 세부 정보를 지정합니다.</span><span class="sxs-lookup"><span data-stu-id="12cb9-141">The user specifies the details of the certificate used to sign messages by specifying the store location and name and the subject name or other unique identifier for the certificate, and the store where the client certificates are located (the certificates used to check signature for incoming messages).</span></span> <span data-ttu-id="12cb9-142">이러한 세부 정보를 기반으로 보안이 향상된 UdpDiscoveryEndpoint가 빌드되고 사용됩니다.</span><span class="sxs-lookup"><span data-stu-id="12cb9-142">Based on these details, a UdpDiscoveryEndpoint with added security is built and used.</span></span>  
  
- <span data-ttu-id="12cb9-143">**클라이언트**: 이 클래스는 ICalculatorService를 검색하고 서비스에서 메서드를 호출하려고 시도합니다.</span><span class="sxs-lookup"><span data-stu-id="12cb9-143">**Client**: This class tries to discover an ICalculatorService and to call methods on the service.</span></span> <span data-ttu-id="12cb9-144">이 경우에도 보안이 향상된 <xref:System.ServiceModel.Discovery.UdpDiscoveryEndpoint>가 빌드되고 메시지를 서명 및 확인하는 데 사용됩니다.</span><span class="sxs-lookup"><span data-stu-id="12cb9-144">Again, a <xref:System.ServiceModel.Discovery.UdpDiscoveryEndpoint> with added security is built and used to sign and verify the messages.</span></span>  
  
- <span data-ttu-id="12cb9-145">**공지 사항Listener**: 온라인 및 오프라인 공지를 듣고 보안 알림 엔드포인트를 사용하는 자체 호스팅 서비스입니다.</span><span class="sxs-lookup"><span data-stu-id="12cb9-145">**AnnouncementListener**: A self-hosted service that listens for online and offline announcements and uses the secure announcement endpoint.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="12cb9-146">Setup.bat가 여러 번 실행되는 경우 인증서 관리자는 중복 인증서가 있으므로 추가할 인증서를 선택하라는 메시지를 표시합니다.</span><span class="sxs-lookup"><span data-stu-id="12cb9-146">If Setup.bat is run multiple times, the certificate manager prompts you for choosing a certificate to add, as there are duplicate certificates.</span></span> <span data-ttu-id="12cb9-147">이 경우 중복이 이미 만들어졌으므로 Setup.bat를 중단하고 Cleanup.bat를 호출해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="12cb9-147">In that case, Setup.bat should be aborted and Cleanup.bat should be called, because the duplicates have already been created.</span></span> <span data-ttu-id="12cb9-148">Cleanup.bat에서도 삭제할 인증서를 선택하라는 메시지를 표시합니다.</span><span class="sxs-lookup"><span data-stu-id="12cb9-148">Cleanup.bat also prompts you to choose a certificate to delete.</span></span> <span data-ttu-id="12cb9-149">목록에서 인증서를 선택하고 남아 있는 인증서가 없을 때까지 Cleanup.bat를 계속 실행합니다.</span><span class="sxs-lookup"><span data-stu-id="12cb9-149">Select a certificate from the list and continue executing Cleanup.bat until no certificates are remaining.</span></span>  
  
#### <a name="to-use-this-sample"></a><span data-ttu-id="12cb9-150">이 샘플을 사용하려면</span><span class="sxs-lookup"><span data-stu-id="12cb9-150">To use this sample</span></span>  
  
1. <span data-ttu-id="12cb9-151">Visual Studio에 대한 개발자 명령 프롬프트에서 Setup.bat 스크립트를 실행합니다.</span><span class="sxs-lookup"><span data-stu-id="12cb9-151">Execute the Setup.bat script from a Developer Command Prompt for Visual Studio.</span></span> <span data-ttu-id="12cb9-152">이 샘플에서는 인증서를 사용하여 메시지를 서명하고 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="12cb9-152">The sample uses certificates to sign and verify messages.</span></span> <span data-ttu-id="12cb9-153">이 스크립트에서는 Makecert.exe를 사용하여 인증서를 만든 다음 Certmgr.exe를 사용하여 인증서를 설치합니다.</span><span class="sxs-lookup"><span data-stu-id="12cb9-153">The script creates the certificates using Makecert.exe and then installs them using Certmgr.exe.</span></span> <span data-ttu-id="12cb9-154">이 스크립트는 관리자 권한으로 실행해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="12cb9-154">The script must be run with administrator privileges.</span></span>  
  
2. <span data-ttu-id="12cb9-155">샘플을 빌드하고 실행하려면 Visual Studio에서 Security.sln 파일을 열고 **모두 재생성 을**선택합니다.</span><span class="sxs-lookup"><span data-stu-id="12cb9-155">To build and run the sample, open the Security.sln file in Visual Studio and choose **Rebuild All**.</span></span> <span data-ttu-id="12cb9-156">여러 프로젝트를 시작하려면 솔루션 속성을 업데이트합니다: DiscoverySecureChannels를 제외한 모든 프로젝트에 대해 **시작을** 선택합니다.</span><span class="sxs-lookup"><span data-stu-id="12cb9-156">Update the solution properties to start multiple projects: select **Start** for all projects except DiscoverySecureChannels.</span></span> <span data-ttu-id="12cb9-157">솔루션을 정상적으로 실행합니다.</span><span class="sxs-lookup"><span data-stu-id="12cb9-157">Run the solution normally.</span></span>  
  
3. <span data-ttu-id="12cb9-158">샘플을 사용하여 작업을 수행한 후 이 샘플에 대해 만들어진 인증서를 제거하는 Cleanup.bat 스크립트를 실행합니다.</span><span class="sxs-lookup"><span data-stu-id="12cb9-158">After you are done with the sample, execute the Cleanup.bat script that removes the certificates created for this sample.</span></span>  
  
> [!IMPORTANT]
> <span data-ttu-id="12cb9-159">컴퓨터에 이 샘플이 이미 설치되어 있을 수도 있습니다.</span><span class="sxs-lookup"><span data-stu-id="12cb9-159">The samples may already be installed on your machine.</span></span> <span data-ttu-id="12cb9-160">계속하기 전에 다음(기본) 디렉터리를 확인하세요.</span><span class="sxs-lookup"><span data-stu-id="12cb9-160">Check for the following (default) directory before continuing.</span></span>  
>
> `<InstallDrive>:\WF_WCF_Samples`  
>
> <span data-ttu-id="12cb9-161">이 디렉터리가 없는 경우 [.NET Framework 4에 대한 WCF(Windows 통신 재단) 및 WF(Windows 워크플로우 재단) 샘플로](https://www.microsoft.com/download/details.aspx?id=21459) 이동하여 모든 WCF(Windows 통신 재단) 및 [!INCLUDE[wf1](../../../../includes/wf1-md.md)] 샘플을 다운로드합니다.</span><span class="sxs-lookup"><span data-stu-id="12cb9-161">If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://www.microsoft.com/download/details.aspx?id=21459) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples.</span></span> <span data-ttu-id="12cb9-162">이 샘플은 다음 디렉터리에 있습니다.</span><span class="sxs-lookup"><span data-stu-id="12cb9-162">This sample is located in the following directory.</span></span>  
>
> `<InstallDrive>:\WF_WCF_Samples\WCF\Scenario\DiscoveryScenario`  

---
title: 메시지 흐름 개요
ms.date: 03/30/2017
ms.assetid: fb0899e1-84cc-4d90-b45b-dc5a50063943
ms.openlocfilehash: d75a535a601612196ef66151a4685723e048848f
ms.sourcegitcommit: 558d78d2a68acd4c95ef23231c8b4e4c7bac3902
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 04/09/2019
ms.locfileid: "59312646"
---
# <a name="message-flow-overview"></a><span data-ttu-id="c4c5d-102">메시지 흐름 개요</span><span class="sxs-lookup"><span data-stu-id="c4c5d-102">Message Flow Overview</span></span>
<span data-ttu-id="c4c5d-103">상호 연결된 서비스가 포함된 분산 시스템에서는 서비스 간의 인과 관계를 확인해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="c4c5d-103">In a distributed system containing interconnected services, it is necessary to determine causal relationships between the services.</span></span> <span data-ttu-id="c4c5d-104">상태 모니터링, 문제 해결 및 근본 원인 분석과 같은 중요한 시나리오를 지원하기 위해 요청 흐름의 일부인 다양한 구성 요소를 이해하는 것이 중요합니다.</span><span class="sxs-lookup"><span data-stu-id="c4c5d-104">It is important to understand the various components that were part of a request flow to support critical scenarios such as health monitoring, troubleshooting, and root cause analysis.</span></span> <span data-ttu-id="c4c5d-105">다양한 서비스 간 추적을 상호 연결할 수 있도록 하기 위해 .NET Framework 4에서는 다음 기능을 통한 지원이 추가되었습니다.</span><span class="sxs-lookup"><span data-stu-id="c4c5d-105">To enable the correlation of traces between various services, in the .NET Framework 4 we added support through the following features:</span></span>

-   <span data-ttu-id="c4c5d-106">분석 추적: 고성능 및 낮은 간단한 추적 기능에 대 한 Windows ETW (이벤트 추적)를 사용 하 여 합니다.</span><span class="sxs-lookup"><span data-stu-id="c4c5d-106">Analytic tracing: A high performance and low verbosity tracing feature using Event Tracing for Windows (ETW).</span></span>

-   <span data-ttu-id="c4c5d-107">WCF/WF 서비스에 대 한 종단 간 활동 모델: 이 기능에서 생성 된 추적의 상관 관계를 지원 합니다 <xref:System.ServiceModel> 고 <xref:System.Workflow.ComponentModel> 네임 스페이스입니다.</span><span class="sxs-lookup"><span data-stu-id="c4c5d-107">End-to-end activity model for WCF/WF services: This feature supports correlation of traces generated by the <xref:System.ServiceModel> and <xref:System.Workflow.ComponentModel> namespaces.</span></span>

-   <span data-ttu-id="c4c5d-108">WF의 ETW 추적: 이 기능은 WF 서비스에서 생성 된 추적 레코드를 사용 하 여 워크플로의 현재 상태와 진행률에 대 한 가시성을 제공.</span><span class="sxs-lookup"><span data-stu-id="c4c5d-108">ETW tracking for WF: This feature uses tracking records generated by WF services to provide visibility into the workflow’s current state and progress.</span></span>

 <span data-ttu-id="c4c5d-109">추적이나 추적 레코드에 기록되는 오류를 사용하여 코드 결함이나 잘못된 형식의 메시지를 찾을 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="c4c5d-109">Errors logged in a tracking or tracing record can be used to find code defects or incorrectly formed messages.</span></span> <span data-ttu-id="c4c5d-110">이벤트의 메시지 헤더에 있는 Correlation 노드의 ActivityId 속성을 사용하여 오류가 발생하는 활동을 확인할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="c4c5d-110">The ActivityId property of the Correlation node in the event’s message header can be used to determine the faulting activity.</span></span> <span data-ttu-id="c4c5d-111">작업 ID 별로 메시지 흐름 추적을 사용 하려면 [Configuring Message Flow Tracing](../../../../docs/framework/wcf/diagnostics/etw/configuring-message-flow-tracing.md)합니다.</span><span class="sxs-lookup"><span data-stu-id="c4c5d-111">To enable message flow tracing by activity ID, see [Configuring Message Flow Tracing](../../../../docs/framework/wcf/diagnostics/etw/configuring-message-flow-tracing.md).</span></span> <span data-ttu-id="c4c5d-112">이 항목에서는 초보자를 위한 자습서에서 만든 프로젝트에서 메시지 흐름 추적을 사용하도록 설정하는 방법을 보여 줍니다.</span><span class="sxs-lookup"><span data-stu-id="c4c5d-112">This topic demonstrates how to enable message flow tracing in the project created in the Getting Started tutorial.</span></span>

### <a name="to-enable-message-flow-tracing-in-the-getting-started-tutorial"></a><span data-ttu-id="c4c5d-113">초보자를 위한 자습서에서 메시지 흐름 추적을 사용하도록 설정하려면</span><span class="sxs-lookup"><span data-stu-id="c4c5d-113">To enable message flow tracing in the Getting Started tutorial</span></span>

1. <span data-ttu-id="c4c5d-114">클릭 하 여 이벤트 뷰어를 엽니다 **시작**를 **실행**를 입력 하 고 `eventvwr.exe`입니다.</span><span class="sxs-lookup"><span data-stu-id="c4c5d-114">Open Event Viewer by clicking **Start**, **Run**, and entering `eventvwr.exe`.</span></span>

2. <span data-ttu-id="c4c5d-115">분석 추적을 활성화 하지 않은 경우 확장 **Applications and Services Logs**를 **Microsoft**하십시오 **Windows**, **응용 프로그램 서버-응용 프로그램** .</span><span class="sxs-lookup"><span data-stu-id="c4c5d-115">If you haven’t enabled analytic tracing, expand **Applications and Services Logs**, **Microsoft**, **Windows**, **Application Server-Applications**.</span></span> <span data-ttu-id="c4c5d-116">선택 **뷰**하십시오 **분석 및 디버그 로그 표시**합니다.</span><span class="sxs-lookup"><span data-stu-id="c4c5d-116">Select **View**, **Show Analytic and Debug Logs**.</span></span> <span data-ttu-id="c4c5d-117">마우스 오른쪽 단추로 클릭 **분석** 선택한 **로그 사용**합니다.</span><span class="sxs-lookup"><span data-stu-id="c4c5d-117">Right-click **Analytic** and select **Enable Log**.</span></span> <span data-ttu-id="c4c5d-118">추적 내용을 볼 수 있도록 이벤트 뷰어를 열어 둡니다.</span><span class="sxs-lookup"><span data-stu-id="c4c5d-118">Leave Event Viewer open so that traces can be viewed.</span></span>

3. <span data-ttu-id="c4c5d-119">만든 샘플을 엽니다는 [초보자를 위한 자습서](../../../../docs/framework/wcf/getting-started-tutorial.md) Visual Studio 2012에서.</span><span class="sxs-lookup"><span data-stu-id="c4c5d-119">Open the sample created in the [Getting Started Tutorial](../../../../docs/framework/wcf/getting-started-tutorial.md) in Visual Studio 2012.</span></span> <span data-ttu-id="c4c5d-120">서비스를 만들 수 있도록 관리자 권한으로 Visual Studio 2012을 실행 해야 하는 참고 합니다.</span><span class="sxs-lookup"><span data-stu-id="c4c5d-120">Note that you must run Visual Studio 2012 as an administrator so that the service can be created.</span></span> <span data-ttu-id="c4c5d-121">설치 하는 WCF 샘플에 있는 경우 열 수 있습니다 합니다 [Getting Started](../../../../docs/framework/wcf/samples/getting-started-sample.md), 자습서에서 만든 완료 된 프로젝트를 포함 하는 합니다.</span><span class="sxs-lookup"><span data-stu-id="c4c5d-121">If you have the WCF samples installed, you can open the [Getting Started](../../../../docs/framework/wcf/samples/getting-started-sample.md), which contains the completed project created in the tutorial.</span></span>

4. <span data-ttu-id="c4c5d-122">마우스 오른쪽 단추로 클릭 합니다 **서비스** 프로젝트를 마우스 **추가**합니다 **새 항목**합니다.</span><span class="sxs-lookup"><span data-stu-id="c4c5d-122">Right-click the **Service** project and select **Add**, **New Item**.</span></span> <span data-ttu-id="c4c5d-123">선택 **응용 프로그램 구성 파일** 누릅니다 **확인**합니다.</span><span class="sxs-lookup"><span data-stu-id="c4c5d-123">Select **Application Configuration File** and click **OK**.</span></span>

5. <span data-ttu-id="c4c5d-124">이전 단계에서 만든 App.Config 파일에 다음 코드를 추가합니다.</span><span class="sxs-lookup"><span data-stu-id="c4c5d-124">Add the following code to the App.Config file created in the previous step.</span></span>

    ```xml
    <system.serviceModel>
      <diagnostics>
        <endToEndTracing propagateActivity="true" messageFlowTracing="true"/>
      </diagnostics>
    </system.serviceModel>
    ```

6. <span data-ttu-id="c4c5d-125">Ctrl+F5를 눌러 서버 응용 프로그램을 디버깅하지 않고 실행합니다.</span><span class="sxs-lookup"><span data-stu-id="c4c5d-125">Execute the server application without debugging by pressing CTRL+F5.</span></span> <span data-ttu-id="c4c5d-126">마우스 오른쪽 단추로 클릭 하 여 클라이언트 프로젝트를 실행 합니다 **클라이언트** 프로젝트 및 선택 **디버그**를 **새 인스턴스 시작**합니다.</span><span class="sxs-lookup"><span data-stu-id="c4c5d-126">Execute the client project by right-clicking the **Client** project and selecting **Debug**, **Start New Instance**.</span></span>

7. <span data-ttu-id="c4c5d-127">클라이언트에서 서버로의 이벤트를 추적하려면 Client 프로젝트의 응용 프로그램 구성 파일에 다음 코드를 추가합니다.</span><span class="sxs-lookup"><span data-stu-id="c4c5d-127">To trace the events from the client to the server, add the following to the application configuration file in the Client project.</span></span>

    ```xml
    <diagnostics>
      <endToEndTracing propagateActivity="true" messageFlowTracing="true"/>
    </diagnostics>
    ```

8. <span data-ttu-id="c4c5d-128">클라이언트의 Program.cs에서 다음 Using 문을 추가합니다.</span><span class="sxs-lookup"><span data-stu-id="c4c5d-128">In Program.cs in the client, add the following Using statement.</span></span>

    ```csharp
    using System.Diagnostics;
    ```

9. <span data-ttu-id="c4c5d-129">클라이언트 프로젝트의 program.cs 파일에 있는 Main 메서드에서 Trace GUID를 이벤트 로그에서 전파되도록 설정합니다.</span><span class="sxs-lookup"><span data-stu-id="c4c5d-129">In the Main method in the program.cs file in the client project, set the Trace GUID to be propagated in the event log.</span></span>

    ```csharp
    Guid guid = Guid.NewGuid();
    Trace.CorrelationManager.ActivityId = guid;
    ```

10. <span data-ttu-id="c4c5d-130">새로 고치고 확인 합니다 **분석** 로그 합니다.</span><span class="sxs-lookup"><span data-stu-id="c4c5d-130">Refresh and examine the **Analytic**  log.</span></span>  <span data-ttu-id="c4c5d-131">이벤트 ID가 220인 이벤트를 찾습니다.</span><span class="sxs-lookup"><span data-stu-id="c4c5d-131">Look for an event with Event ID 220.</span></span>  <span data-ttu-id="c4c5d-132">이벤트를 선택 하 고 클릭 합니다 **세부 정보** 미리 보기 창에서 탭 합니다.</span><span class="sxs-lookup"><span data-stu-id="c4c5d-132">Select the event, and click the **Details** tab in the preview pane.</span></span> <span data-ttu-id="c4c5d-133">이 이벤트에는 호출 활동의 상관 관계 ID가 포함됩니다.</span><span class="sxs-lookup"><span data-stu-id="c4c5d-133">This event will contain the correlation ID for the calling activity.</span></span>

    ```xml
    <Correlation ActivityID="{A066CCF1-8AB3-459B-B62F-F79F957A5036}" />
    ```

    > [!NOTE]
    >  <span data-ttu-id="c4c5d-134">ActivityID에서 동일한 GUID를 가진 모든 이벤트는 한 요청과 관련되어 있습니다.</span><span class="sxs-lookup"><span data-stu-id="c4c5d-134">All events with the same GUID in the ActivityID are related to one request.</span></span> <span data-ttu-id="c4c5d-135">이를 이용하여 특정 클라이언트에서 특정 서비스로의 메시지를 상호 연결할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="c4c5d-135">This can be used to correlate messages from a specific client to a specific service.</span></span> <span data-ttu-id="c4c5d-136">클라이언트에서 또 다른 서비스를 호출한 경우 동일한 클라이언트가 ActivityID로 식별될 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="c4c5d-136">If the client called another service, then the same client could be identified by ActivityID.</span></span>

11. <span data-ttu-id="c4c5d-137">경우에 따라 ActivityID가 원래 GUID에서 새 ActivityID로 변경될 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="c4c5d-137">In some cases, the ActivityID can change from the original GUID to a new ActivityID.</span></span> <span data-ttu-id="c4c5d-138">이 경우 전송 이벤트가 내보내집니다.</span><span class="sxs-lookup"><span data-stu-id="c4c5d-138">In that case, a transfer event is emitted.</span></span> <span data-ttu-id="c4c5d-139">이 이벤트 ID는 499이며 헤더에 다음 데이터를 포함합니다.</span><span class="sxs-lookup"><span data-stu-id="c4c5d-139">This event ID is 499, and the event will contain the following data in the header.</span></span>

    ```xml
    <Event xmlns="http://schemas.microsoft.com/win/2004/08/events/event">
        <System>
            <Provider Name="Microsoft-Windows-Application Server-Applications" Guid="{c651f5f6-1c0d-492e-8ae1-b4efd7c9d503}" />
            <EventID>499</EventID>
            ...
            <Correlation ActivityID="{A066CCF1-8AB3-459B-B62F-F79F957A5036}" RelatedActivityID="{85FC0930-9C49-42DA-804B-A7368104BD1B}" />
            ...
       </System>
    </Event>
    ```

    > [!NOTE]
    >  <span data-ttu-id="c4c5d-140">전송 이벤트는 ActivityID로 지정된 GUID에서 RelatedActivityID로 지정된 GUID로 활성 ActivityID가 변경된 것을 기록합니다.</span><span class="sxs-lookup"><span data-stu-id="c4c5d-140">The transfer event records the change of the active ActivityID from the GUID specified as the ActivityID to the GUID specified as RelatedActivityID.</span></span> <span data-ttu-id="c4c5d-141">전송 이벤트가 내보내진 후 모든 이벤트에는 새 GUID가 ActivityID로 포함됩니다.</span><span class="sxs-lookup"><span data-stu-id="c4c5d-141">After the transfer event is emitted, all events will contain the new GUID as the ActivityID.</span></span>

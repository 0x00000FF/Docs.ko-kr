---
title: Direct3D9 및 WPF interop에 대 한 성능 고려 사항
titleSuffix: ''
ms.date: 03/30/2017
helpviewer_keywords:
- WPF [WPF], Direct3D9 interop performance
- Direct3D9 [WPF interoperability], performance
ms.assetid: ea8baf91-12fe-4b44-ac4d-477110ab14dd
ms.openlocfilehash: 2445732c27d210a41da26303d6a9ce07ef6fcc94
ms.sourcegitcommit: de17a7a0a37042f0d4406f5ae5393531caeb25ba
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 01/24/2020
ms.locfileid: "76743938"
---
# <a name="performance-considerations-for-direct3d9-and-wpf-interoperability"></a><span data-ttu-id="68454-102">Direct3D9 및 WPF 상호 운용성을 위한 성능 고려 사항</span><span class="sxs-lookup"><span data-stu-id="68454-102">Performance Considerations for Direct3D9 and WPF Interoperability</span></span>
<span data-ttu-id="68454-103"><xref:System.Windows.Interop.D3DImage> 클래스를 사용 하 여 Direct3D9 콘텐츠를 호스트할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="68454-103">You can host Direct3D9 content by using the <xref:System.Windows.Interop.D3DImage> class.</span></span> <span data-ttu-id="68454-104">Direct3D9 콘텐츠를 호스팅하면 응용 프로그램의 성능에 영향을 줄 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="68454-104">Hosting Direct3D9 content can affect the performance of your application.</span></span> <span data-ttu-id="68454-105">이 항목에서는 Windows Presentation Foundation (WPF) 응용 프로그램에서 Direct3D9 콘텐츠를 호스팅할 때 성능을 최적화 하는 모범 사례에 대해 설명 합니다.</span><span class="sxs-lookup"><span data-stu-id="68454-105">This topic describes best practices to optimize performance when hosting Direct3D9 content in a Windows Presentation Foundation (WPF) application.</span></span> <span data-ttu-id="68454-106">이러한 모범 사례에는 Windows Vista, Windows XP 및 다중 모니터 디스플레이를 사용 하는 경우 <xref:System.Windows.Interop.D3DImage> 및 모범 사례를 사용 하는 방법이 포함 됩니다.</span><span class="sxs-lookup"><span data-stu-id="68454-106">These best practices include how to use <xref:System.Windows.Interop.D3DImage> and best practices when you are using Windows Vista, Windows XP, and multi-monitor displays.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="68454-107">이러한 모범 사례를 보여 주는 코드 예제는 [WPF 및 Direct3D9 상호 운용성](wpf-and-direct3d9-interoperation.md)을 참조 하세요.</span><span class="sxs-lookup"><span data-stu-id="68454-107">For code examples that demonstrate these best practices, see [WPF and Direct3D9 Interoperation](wpf-and-direct3d9-interoperation.md).</span></span>  
  
## <a name="use-d3dimage-sparingly"></a><span data-ttu-id="68454-108">D3DImage만 사용</span><span class="sxs-lookup"><span data-stu-id="68454-108">Use D3DImage Sparingly</span></span>  
 <span data-ttu-id="68454-109"><xref:System.Windows.Interop.D3DImage> 인스턴스에서 호스트 되는 Direct3D9 콘텐츠는 순수 Direct3D 응용 프로그램에서와 같이 렌더링 되지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="68454-109">Direct3D9 content hosted in a <xref:System.Windows.Interop.D3DImage> instance does not render as fast as in a pure Direct3D application.</span></span> <span data-ttu-id="68454-110">화면을 복사 하 고 명령 버퍼를 플러시하는 작업은 비용이 많이 들 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="68454-110">Copying the surface and flushing the command buffer can be costly operations.</span></span> <span data-ttu-id="68454-111"><xref:System.Windows.Interop.D3DImage> 인스턴스의 수가 늘어나면 더 많은 플러시가 발생 하 고 성능이 저하 됩니다.</span><span class="sxs-lookup"><span data-stu-id="68454-111">As the number of <xref:System.Windows.Interop.D3DImage> instances increases, more flushing occurs, and performance degrades.</span></span> <span data-ttu-id="68454-112">따라서 <xref:System.Windows.Interop.D3DImage>만 사용 해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="68454-112">Therefore, you should use <xref:System.Windows.Interop.D3DImage> sparingly.</span></span>  
  
## <a name="best-practices-on-windows-vista"></a><span data-ttu-id="68454-113">Windows Vista에 대 한 모범 사례</span><span class="sxs-lookup"><span data-stu-id="68454-113">Best Practices on Windows Vista</span></span>  
 <span data-ttu-id="68454-114">Windows Vista에서 WDDM (Windows Display Driver Model)을 사용 하도록 구성 된 디스플레이를 사용 하 여 최상의 성능을 위해 `IDirect3DDevice9Ex` 장치에서 Direct3D9 화면을 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="68454-114">For best performance on Windows Vista with a display that is configured to use the Windows Display Driver Model (WDDM), create your Direct3D9 surface on an `IDirect3DDevice9Ex` device.</span></span> <span data-ttu-id="68454-115">이렇게 하면 화면 공유를 사용할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="68454-115">This enables surface sharing.</span></span> <span data-ttu-id="68454-116">비디오 카드는 Windows Vista의 `D3DDEVCAPS2_CAN_STRETCHRECT_FROM_TEXTURES` 및 `D3DCAPS2_CANSHARERESOURCE` 드라이버 기능을 지원 해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="68454-116">The video card must support the `D3DDEVCAPS2_CAN_STRETCHRECT_FROM_TEXTURES` and `D3DCAPS2_CANSHARERESOURCE` driver capabilities on Windows Vista.</span></span> <span data-ttu-id="68454-117">다른 모든 설정은 화면을 소프트웨어를 통해 복사 하 여 성능을 현저 하 게 줄입니다.</span><span class="sxs-lookup"><span data-stu-id="68454-117">Any other settings cause the surface to be copied through software, which reduces performance significantly.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="68454-118">Windows Vista에서 XDDM (Windows XP Display Driver Model)을 사용 하도록 구성 된 디스플레이를 사용 하는 경우 화면은 설정에 관계 없이 항상 소프트웨어를 통해 복사 됩니다.</span><span class="sxs-lookup"><span data-stu-id="68454-118">If Windows Vista has a display that is configured to use the Windows XP Display Driver Model (XDDM), the surface is always copied through software, regardless of settings.</span></span> <span data-ttu-id="68454-119">적절 한 설정 및 비디오 카드를 사용 하면 화면 복사본이 하드웨어에서 수행 되기 때문에 WDDM을 사용 하면 Windows Vista에서 더 나은 성능을 볼 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="68454-119">With the proper settings and video card, you will see better performance on Windows Vista when you use the WDDM because surface copies are performed in hardware.</span></span>  
  
## <a name="best-practices-on-windows-xp"></a><span data-ttu-id="68454-120">Windows XP에 대 한 모범 사례</span><span class="sxs-lookup"><span data-stu-id="68454-120">Best Practices on Windows XP</span></span>  
 <span data-ttu-id="68454-121">XDDM (Windows XP 디스플레이 드라이버 모델)을 사용 하는 Windows XP의 성능을 최적화 하려면 `IDirect3DSurface9::GetDC` 메서드가 호출 될 때 올바르게 동작 하는 잠글 수 있는 화면을 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="68454-121">For best performance on Windows XP, which uses the Windows XP Display Driver Model (XDDM), create a lockable surface that behaves correctly when the `IDirect3DSurface9::GetDC` method is called.</span></span> <span data-ttu-id="68454-122">내부적으로 `BitBlt` 메서드는 하드웨어의 장치에서 화면을 전송 합니다.</span><span class="sxs-lookup"><span data-stu-id="68454-122">Internally, the `BitBlt` method transfers the surface across devices in hardware.</span></span> <span data-ttu-id="68454-123">`GetDC` 메서드는 항상 XRGB 표면에서 작동 합니다.</span><span class="sxs-lookup"><span data-stu-id="68454-123">The `GetDC` method always works on XRGB surfaces.</span></span> <span data-ttu-id="68454-124">그러나 클라이언트 컴퓨터에서 Windows XP SP3 또는 s p 2를 실행 하 고 있고 계층 창 기능에 대 한 핫픽스도 클라이언트에 있는 경우이 메서드는 ARGB 표면 에서만 작동 합니다.</span><span class="sxs-lookup"><span data-stu-id="68454-124">However, if the client computer is running Windows XP with SP3 or SP2, and if the client also has the hotfix for the layered-window feature, this method only works on ARGB surfaces.</span></span> <span data-ttu-id="68454-125">비디오 카드는 `D3DDEVCAPS2_CAN_STRETCHRECT_FROM_TEXTURES` 드라이버 기능을 지원 해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="68454-125">The video card must support the `D3DDEVCAPS2_CAN_STRETCHRECT_FROM_TEXTURES` driver capability.</span></span>  
  
 <span data-ttu-id="68454-126">16 비트 데스크톱 디스플레이 깊이가 성능을 크게 낮출 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="68454-126">A 16-bit desktop display depth can significantly reduce performance.</span></span> <span data-ttu-id="68454-127">32 비트 데스크톱을 권장 합니다.</span><span class="sxs-lookup"><span data-stu-id="68454-127">A 32-bit desktop is recommended.</span></span>  
  
 <span data-ttu-id="68454-128">Windows Vista 및 Windows XP 용으로 개발 하는 경우 Windows XP에서 성능을 테스트 합니다.</span><span class="sxs-lookup"><span data-stu-id="68454-128">If you are developing for Windows Vista and Windows XP, test the performance on Windows XP.</span></span> <span data-ttu-id="68454-129">Windows XP에서 비디오 메모리가 부족 하 게 되는 것이 중요 합니다.</span><span class="sxs-lookup"><span data-stu-id="68454-129">Running out of video memory on Windows XP is a concern.</span></span> <span data-ttu-id="68454-130">또한 Windows XP의 <xref:System.Windows.Interop.D3DImage>에는 필요한 추가 비디오 메모리 복사로 인해 Windows Vista WDDM 보다 더 많은 비디오 메모리 및 대역폭이 사용 됩니다.</span><span class="sxs-lookup"><span data-stu-id="68454-130">In addition, <xref:System.Windows.Interop.D3DImage> on Windows XP uses more video memory and bandwidth than Windows Vista WDDM, due to a necessary extra video memory copy.</span></span> <span data-ttu-id="68454-131">따라서 동일한 비디오 하드웨어에 대해 windows Vista 보다 Windows XP에서 성능이 저하 될 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="68454-131">Therefore, you can expect performance to be worse on Windows XP than on Windows Vista for the same video hardware.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="68454-132">XDDM은 Windows XP 및 Windows Vista에서 모두 사용할 수 있습니다. 그러나 WDDM은 Windows Vista 에서만 사용할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="68454-132">XDDM is available on both Windows XP and Windows Vista; however, WDDM is available only on Windows Vista.</span></span>  
  
## <a name="general-best-practices"></a><span data-ttu-id="68454-133">일반 모범 사례</span><span class="sxs-lookup"><span data-stu-id="68454-133">General Best Practices</span></span>  
 <span data-ttu-id="68454-134">장치를 만들 때 `D3DCREATE_MULTITHREADED` 만들기 플래그를 사용 합니다.</span><span class="sxs-lookup"><span data-stu-id="68454-134">When you create the device, use the `D3DCREATE_MULTITHREADED` creation flag.</span></span> <span data-ttu-id="68454-135">이렇게 하면 성능이 저하 되지만 WPF 렌더링 시스템은 다른 스레드에서이 장치에 대 한 메서드를 호출 합니다.</span><span class="sxs-lookup"><span data-stu-id="68454-135">This reduces performance, but the WPF rendering system calls methods on this device from another thread.</span></span> <span data-ttu-id="68454-136">두 스레드가 동시에 장치에 액세스 하지 않도록 잠금 프로토콜을 올바르게 준수 해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="68454-136">Be sure to follow the locking protocol correctly, so that no two threads access the device at the same time.</span></span>  
  
 <span data-ttu-id="68454-137">WPF 관리 스레드에서 렌더링을 수행 하는 경우 `D3DCREATE_FPU_PRESERVE` 생성 플래그를 사용 하 여 장치를 만드는 것이 좋습니다.</span><span class="sxs-lookup"><span data-stu-id="68454-137">If your rendering is performed on a WPF managed thread, it is strongly recommended that you create the device with the `D3DCREATE_FPU_PRESERVE` creation flag.</span></span> <span data-ttu-id="68454-138">이 설정이 없으면 D3D 렌더링은 WPF 배정밀도 작업의 정확도를 줄이고 렌더링 문제를 발생 시킬 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="68454-138">Without this setting, the D3D rendering can reduce the accuracy of WPF double-precision operations and introduce rendering issues.</span></span>  
  
 <span data-ttu-id="68454-139">하드웨어 지원 없이 pow2 표면을 바둑판식으로 배열 하거나 <xref:System.Windows.Interop.D3DImage>를 포함 하는 <xref:System.Windows.Media.DrawingBrush> 또는 <xref:System.Windows.Media.VisualBrush>를 바둑판식으로 배열 하지 않는 한, <xref:System.Windows.Interop.D3DImage>을 바둑판식으로 배열 하는 것이 더 빠릅니다.</span><span class="sxs-lookup"><span data-stu-id="68454-139">Tiling a <xref:System.Windows.Interop.D3DImage> is fast, unless you tile a non-pow2 surface without hardware support, or if you tile a <xref:System.Windows.Media.DrawingBrush> or <xref:System.Windows.Media.VisualBrush> that contains a <xref:System.Windows.Interop.D3DImage>.</span></span>  
  
## <a name="best-practices-for-multi-monitor-displays"></a><span data-ttu-id="68454-140">다중 모니터 표시에 대 한 모범 사례</span><span class="sxs-lookup"><span data-stu-id="68454-140">Best Practices for Multi-Monitor Displays</span></span>  
 <span data-ttu-id="68454-141">여러 모니터가 있는 컴퓨터를 사용 하는 경우 앞에서 설명한 모범 사례를 따라야 합니다.</span><span class="sxs-lookup"><span data-stu-id="68454-141">If you are using a computer that has multiple monitors, you should follow the previously described best practices.</span></span> <span data-ttu-id="68454-142">다중 모니터 구성의 경우 몇 가지 추가 성능 고려 사항도 있습니다.</span><span class="sxs-lookup"><span data-stu-id="68454-142">There are also some additional performance considerations for a multi-monitor configuration.</span></span>  
  
 <span data-ttu-id="68454-143">백 버퍼를 만들 때 특정 장치 및 어댑터에서 만들어지므로 WPF는 모든 어댑터에 프런트 버퍼를 표시할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="68454-143">When you create the back buffer, it is created on a specific device and adapter, but WPF may display the front buffer on any adapter.</span></span> <span data-ttu-id="68454-144">프런트 버퍼를 업데이트 하기 위해 어댑터 간에 복사 하는 데는 매우 많은 비용이 소요 될 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="68454-144">Copying across adapters to update the front buffer can be very expensive.</span></span> <span data-ttu-id="68454-145">여러 비디오 카드와 `IDirect3DDevice9Ex` 장치에서 WDDM을 사용 하도록 구성 된 Windows Vista에서는 프런트 버퍼가 다른 어댑터에 있지만 여전히 동일한 비디오 카드에 있는 경우 성능 저하는 발생 하지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="68454-145">On Windows Vista that is configured to use the WDDM with multiple video cards and with an `IDirect3DDevice9Ex` device, if the front buffer is on a different adapter but still the same video card, there is no performance penalty.</span></span> <span data-ttu-id="68454-146">그러나 Windows XP 및 여러 비디오 카드를 사용 하는 XDDM에서는 프런트 버퍼가 백 버퍼가 아닌 다른 어댑터에 표시 되는 경우 상당한 성능 저하가 발생 합니다.</span><span class="sxs-lookup"><span data-stu-id="68454-146">However, on Windows XP and the XDDM with multiple video cards, there is a significant performance penalty when the front buffer is displayed on a different adapter than the back buffer.</span></span> <span data-ttu-id="68454-147">자세한 내용은 [WPF 및 Direct3D9 상호 운용성](wpf-and-direct3d9-interoperation.md)을 참조 하세요.</span><span class="sxs-lookup"><span data-stu-id="68454-147">For more information, see [WPF and Direct3D9 Interoperation](wpf-and-direct3d9-interoperation.md).</span></span>  
  
## <a name="performance-summary"></a><span data-ttu-id="68454-148">성능 요약</span><span class="sxs-lookup"><span data-stu-id="68454-148">Performance Summary</span></span>  
 <span data-ttu-id="68454-149">다음 표에서는 운영 체제, 픽셀 형식 및 표면 잠금 기능의 기능으로 서의 프런트 버퍼 업데이트 성능을 보여 줍니다.</span><span class="sxs-lookup"><span data-stu-id="68454-149">The following table shows performance of the front buffer update as a function of operating system, pixel format, and surface lockability.</span></span> <span data-ttu-id="68454-150">프런트 버퍼와 백 버퍼는 동일한 어댑터에 있는 것으로 간주 됩니다.</span><span class="sxs-lookup"><span data-stu-id="68454-150">The front buffer and back buffer are assumed to be on the same adapter.</span></span> <span data-ttu-id="68454-151">어댑터 구성에 따라 하드웨어 업데이트는 일반적으로 소프트웨어 업데이트 보다 훨씬 빠릅니다.</span><span class="sxs-lookup"><span data-stu-id="68454-151">Depending on the adapter configuration, hardware updates are generally much faster than software updates.</span></span>  
  
|<span data-ttu-id="68454-152">표면 픽셀 형식</span><span class="sxs-lookup"><span data-stu-id="68454-152">Surface pixel format</span></span>|<span data-ttu-id="68454-153">Windows Vista, WDDM 및 9Ex</span><span class="sxs-lookup"><span data-stu-id="68454-153">Windows Vista, WDDM and 9Ex</span></span>|<span data-ttu-id="68454-154">기타 Windows Vista 구성</span><span class="sxs-lookup"><span data-stu-id="68454-154">Other Windows Vista configurations</span></span>|<span data-ttu-id="68454-155">Windows XP SP3 또는 SP2 w/핫픽스</span><span class="sxs-lookup"><span data-stu-id="68454-155">Windows XP SP3 or SP2 w/ hotfix</span></span>|<span data-ttu-id="68454-156">Windows XP SP2</span><span class="sxs-lookup"><span data-stu-id="68454-156">Windows XP SP2</span></span>|  
|--------------------------|---------------------------------|----------------------------------------|--------------------------------------|--------------------|  
|<span data-ttu-id="68454-157">D3DFMT_X8R8G8B8 (잠글 수 없음)</span><span class="sxs-lookup"><span data-stu-id="68454-157">D3DFMT_X8R8G8B8 (not lockable)</span></span>|<span data-ttu-id="68454-158">**하드웨어 업데이트**</span><span class="sxs-lookup"><span data-stu-id="68454-158">**Hardware Update**</span></span>|<span data-ttu-id="68454-159">소프트웨어 업데이트</span><span class="sxs-lookup"><span data-stu-id="68454-159">Software Update</span></span>|<span data-ttu-id="68454-160">소프트웨어 업데이트</span><span class="sxs-lookup"><span data-stu-id="68454-160">Software Update</span></span>|<span data-ttu-id="68454-161">소프트웨어 업데이트</span><span class="sxs-lookup"><span data-stu-id="68454-161">Software Update</span></span>|  
|<span data-ttu-id="68454-162">D3DFMT_X8R8G8B8 (잠금 가능)</span><span class="sxs-lookup"><span data-stu-id="68454-162">D3DFMT_X8R8G8B8 (lockable)</span></span>|<span data-ttu-id="68454-163">**하드웨어 업데이트**</span><span class="sxs-lookup"><span data-stu-id="68454-163">**Hardware Update**</span></span>|<span data-ttu-id="68454-164">소프트웨어 업데이트</span><span class="sxs-lookup"><span data-stu-id="68454-164">Software Update</span></span>|<span data-ttu-id="68454-165">**하드웨어 업데이트**</span><span class="sxs-lookup"><span data-stu-id="68454-165">**Hardware Update**</span></span>|<span data-ttu-id="68454-166">**하드웨어 업데이트**</span><span class="sxs-lookup"><span data-stu-id="68454-166">**Hardware Update**</span></span>|  
|<span data-ttu-id="68454-167">D3DFMT_A8R8G8B8 (잠글 수 없음)</span><span class="sxs-lookup"><span data-stu-id="68454-167">D3DFMT_A8R8G8B8 (not lockable)</span></span>|<span data-ttu-id="68454-168">**하드웨어 업데이트**</span><span class="sxs-lookup"><span data-stu-id="68454-168">**Hardware Update**</span></span>|<span data-ttu-id="68454-169">소프트웨어 업데이트</span><span class="sxs-lookup"><span data-stu-id="68454-169">Software Update</span></span>|<span data-ttu-id="68454-170">소프트웨어 업데이트</span><span class="sxs-lookup"><span data-stu-id="68454-170">Software Update</span></span>|<span data-ttu-id="68454-171">소프트웨어 업데이트</span><span class="sxs-lookup"><span data-stu-id="68454-171">Software Update</span></span>|  
|<span data-ttu-id="68454-172">D3DFMT_A8R8G8B8 (잠금 가능)</span><span class="sxs-lookup"><span data-stu-id="68454-172">D3DFMT_A8R8G8B8 (lockable)</span></span>|<span data-ttu-id="68454-173">**하드웨어 업데이트**</span><span class="sxs-lookup"><span data-stu-id="68454-173">**Hardware Update**</span></span>|<span data-ttu-id="68454-174">소프트웨어 업데이트</span><span class="sxs-lookup"><span data-stu-id="68454-174">Software Update</span></span>|<span data-ttu-id="68454-175">**하드웨어 업데이트**</span><span class="sxs-lookup"><span data-stu-id="68454-175">**Hardware Update**</span></span>|<span data-ttu-id="68454-176">소프트웨어 업데이트</span><span class="sxs-lookup"><span data-stu-id="68454-176">Software Update</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="68454-177">참고 항목</span><span class="sxs-lookup"><span data-stu-id="68454-177">See also</span></span>

- <xref:System.Windows.Interop.D3DImage>
- [<span data-ttu-id="68454-178">WPF 및 Direct3D9 상호 운용성</span><span class="sxs-lookup"><span data-stu-id="68454-178">WPF and Direct3D9 Interoperation</span></span>](wpf-and-direct3d9-interoperation.md)
- [<span data-ttu-id="68454-179">연습: WPF에서 호스팅할 Direct3D9 콘텐츠 만들기</span><span class="sxs-lookup"><span data-stu-id="68454-179">Walkthrough: Creating Direct3D9 Content for Hosting in WPF</span></span>](walkthrough-creating-direct3d9-content-for-hosting-in-wpf.md)
- [<span data-ttu-id="68454-180">연습: WPF에서 Direct3D9 콘텐츠 호스팅</span><span class="sxs-lookup"><span data-stu-id="68454-180">Walkthrough: Hosting Direct3D9 Content in WPF</span></span>](walkthrough-hosting-direct3d9-content-in-wpf.md)
